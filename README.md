# é£Ÿå“åŒ…è£…è¯†åˆ«æ£€æµ‹ç³»ç»Ÿæºç åˆ†äº«
 # [ä¸€æ¡é¾™æ•™å­¦YOLOV8æ ‡æ³¨å¥½çš„æ•°æ®é›†ä¸€é”®è®­ç»ƒ_70+å…¨å¥—æ”¹è¿›åˆ›æ–°ç‚¹å‘åˆŠ_Webå‰ç«¯å±•ç¤º]

### 1.ç ”ç©¶èƒŒæ™¯ä¸æ„ä¹‰

é¡¹ç›®å‚è€ƒ[AAAI Association for the Advancement of Artificial Intelligence](https://gitee.com/qunshansj/projects)

é¡¹ç›®æ¥æº[AACV Association for the Advancement of Computer Vision](https://gitee.com/qunmasj/projects)

ç ”ç©¶èƒŒæ™¯ä¸æ„ä¹‰

éšç€å…¨çƒç»æµçš„å¿«é€Ÿå‘å±•å’Œç”Ÿæ´»æ°´å¹³çš„æé«˜ï¼Œé£Ÿå“æ¶ˆè´¹å¸‚åœºæ—¥ç›Šç¹è£ï¼Œé£Ÿå“åŒ…è£…çš„å¤šæ ·æ€§å’Œå¤æ‚æ€§ä¹Ÿéšä¹‹å¢åŠ ã€‚é£Ÿå“åŒ…è£…ä¸ä»…æ˜¯ä¿æŠ¤é£Ÿå“çš„ç‰©ç†å±éšœï¼Œæ›´æ˜¯ä¼ é€’å“ç‰Œå½¢è±¡å’Œæ¶ˆè´¹è€…ä¿¡æ¯çš„é‡è¦è½½ä½“ã€‚åœ¨è¿™ä¸€èƒŒæ™¯ä¸‹ï¼Œé£Ÿå“åŒ…è£…çš„è¯†åˆ«ä¸åˆ†ç±»æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚ä¼ ç»Ÿçš„äººå·¥è¯†åˆ«æ–¹æ³•ä¸ä»…æ•ˆç‡ä½ä¸‹ï¼Œè€Œä¸”å®¹æ˜“å—åˆ°äººä¸ºå› ç´ çš„å½±å“ï¼Œéš¾ä»¥æ»¡è¶³ç°ä»£åŒ–ç”Ÿäº§å’Œé”€å”®çš„éœ€æ±‚ã€‚å› æ­¤ï¼Œå¼€å‘ä¸€ç§é«˜æ•ˆã€å‡†ç¡®çš„é£Ÿå“åŒ…è£…è¯†åˆ«ç³»ç»Ÿï¼Œæˆä¸ºäº†è¡Œä¸šäºŸå¾…è§£å†³çš„é—®é¢˜ã€‚

è¿‘å¹´æ¥ï¼Œæ·±åº¦å­¦ä¹ æŠ€æœ¯çš„è¿…çŒ›å‘å±•ä¸ºè®¡ç®—æœºè§†è§‰é¢†åŸŸå¸¦æ¥äº†é©å‘½æ€§çš„å˜åŒ–ï¼Œå°¤å…¶æ˜¯åœ¨ç›®æ ‡æ£€æµ‹æ–¹é¢ã€‚YOLOï¼ˆYou Only Look Onceï¼‰ç³»åˆ—æ¨¡å‹å› å…¶å®æ—¶æ€§å’Œé«˜å‡†ç¡®ç‡è€Œå¹¿æ³›åº”ç”¨äºå„ç±»ç‰©ä½“æ£€æµ‹ä»»åŠ¡ã€‚YOLOv8ä½œä¸ºè¯¥ç³»åˆ—çš„æœ€æ–°ç‰ˆæœ¬ï¼Œç»“åˆäº†æ›´ä¸ºå…ˆè¿›çš„ç½‘ç»œç»“æ„å’Œè®­ç»ƒç­–ç•¥ï¼Œå…·æœ‰æ›´å¼ºçš„ç‰¹å¾æå–èƒ½åŠ›å’Œæ›´å¿«çš„æ¨ç†é€Ÿåº¦ã€‚ç„¶è€Œï¼Œå°½ç®¡YOLOv8åœ¨è®¸å¤šåº”ç”¨åœºæ™¯ä¸­è¡¨ç°å‡ºè‰²ï¼Œä½†åœ¨ç‰¹å®šé¢†åŸŸï¼Œå¦‚é£Ÿå“åŒ…è£…è¯†åˆ«ï¼Œä»ç„¶å­˜åœ¨ä¸€äº›æŒ‘æˆ˜ã€‚ä¾‹å¦‚ï¼Œé£Ÿå“åŒ…è£…çš„å¤–è§‚å¤šæ ·æ€§ã€å…‰ç…§å˜åŒ–ã€èƒŒæ™¯å¤æ‚æ€§ç­‰å› ç´ ï¼Œå¯èƒ½å¯¼è‡´æ¨¡å‹çš„è¯†åˆ«å‡†ç¡®ç‡ä¸‹é™ã€‚å› æ­¤ï¼ŒåŸºäºæ”¹è¿›YOLOv8çš„é£Ÿå“åŒ…è£…è¯†åˆ«ç³»ç»Ÿçš„ç ”ç©¶ï¼Œå…·æœ‰é‡è¦çš„ç†è®ºå’Œå®é™…æ„ä¹‰ã€‚

æœ¬ç ”ç©¶æ‰€ä½¿ç”¨çš„æ•°æ®é›†åŒ…å«3961å¼ å›¾åƒï¼Œæ¶µç›–21ä¸ªç±»åˆ«çš„é£Ÿå“åŒ…è£…ï¼ŒåŒ…æ‹¬çŸ¥åå“ç‰Œå¦‚â€œå¯å£å¯ä¹â€ã€â€œä¸ƒæ˜Ÿæ±½æ°´â€ç­‰ã€‚è¿™äº›æ•°æ®ä¸ä»…ä¸°å¯Œäº†æ¨¡å‹çš„è®­ç»ƒæ ·æœ¬ï¼Œä¹Ÿä¸ºå…¶åœ¨å®é™…åº”ç”¨ä¸­çš„æ¨å¹¿æä¾›äº†åšå®çš„åŸºç¡€ã€‚é€šè¿‡å¯¹è¿™äº›æ•°æ®çš„æ·±å…¥åˆ†æå’Œå¤„ç†ï¼Œå¯ä»¥æœ‰æ•ˆæå‡æ¨¡å‹å¯¹ä¸åŒç±»å‹é£Ÿå“åŒ…è£…çš„è¯†åˆ«èƒ½åŠ›ï¼Œè¿›è€Œå®ç°æ›´é«˜çš„å‡†ç¡®ç‡å’Œæ›´å¿«çš„è¯†åˆ«é€Ÿåº¦ã€‚æ­¤å¤–ï¼Œé’ˆå¯¹ç‰¹å®šç±»åˆ«çš„é£Ÿå“åŒ…è£…ï¼Œç ”ç©¶è€…å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œæ¨¡å‹çš„å¾®è°ƒå’Œä¼˜åŒ–ï¼Œä»¥æ»¡è¶³ä¸åŒåœºæ™¯ä¸‹çš„åº”ç”¨éœ€æ±‚ã€‚

åœ¨é£Ÿå“å®‰å…¨æ—¥ç›Šå—åˆ°é‡è§†çš„ä»Šå¤©ï¼Œé£Ÿå“åŒ…è£…çš„è¯†åˆ«ç³»ç»Ÿä¸ä»…èƒ½å¤Ÿå¸®åŠ©ä¼ä¸šæé«˜ç”Ÿäº§æ•ˆç‡ï¼Œé™ä½äººå·¥æˆæœ¬ï¼Œè¿˜èƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¿éšœæ¶ˆè´¹è€…çš„æƒç›Šã€‚é€šè¿‡è‡ªåŠ¨åŒ–çš„è¯†åˆ«ç³»ç»Ÿï¼Œä¼ä¸šå¯ä»¥å®æ—¶ç›‘æ§äº§å“çš„åŒ…è£…æƒ…å†µï¼ŒåŠæ—¶å‘ç°å’Œçº æ­£æ½œåœ¨çš„åŒ…è£…é—®é¢˜ï¼Œç¡®ä¿äº§å“è´¨é‡ã€‚åŒæ—¶ï¼Œè¯¥ç³»ç»Ÿä¹Ÿå¯ä»¥ä¸ºæ¶ˆè´¹è€…æä¾›æ›´ä¸ºç›´è§‚çš„ä¿¡æ¯ï¼Œå¸®åŠ©ä»–ä»¬åšå‡ºæ›´ä¸ºæ˜æ™ºçš„è´­ä¹°å†³ç­–ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼ŒåŸºäºæ”¹è¿›YOLOv8çš„é£Ÿå“åŒ…è£…è¯†åˆ«ç³»ç»Ÿçš„ç ”ç©¶ï¼Œä¸ä»…å…·æœ‰é‡è¦çš„å­¦æœ¯ä»·å€¼ï¼Œè¿˜æœ‰åŠ©äºæ¨åŠ¨é£Ÿå“è¡Œä¸šçš„æ™ºèƒ½åŒ–å‘å±•ã€‚é€šè¿‡æå‡é£Ÿå“åŒ…è£…çš„è¯†åˆ«æ•ˆç‡å’Œå‡†ç¡®æ€§ï¼Œèƒ½å¤Ÿä¸ºä¼ä¸šå¸¦æ¥æ˜¾è‘—çš„ç»æµæ•ˆç›Šï¼ŒåŒæ—¶ä¹Ÿä¸ºæ¶ˆè´¹è€…æä¾›æ›´ä¸ºå®‰å…¨ã€ä¾¿æ·çš„è´­ç‰©ä½“éªŒã€‚å› æ­¤ï¼Œæœ¬ç ”ç©¶çš„å¼€å±•ï¼Œå…·æœ‰æ·±è¿œçš„ç¤¾ä¼šæ„ä¹‰å’Œå¹¿é˜”çš„åº”ç”¨å‰æ™¯ã€‚

### 2.å›¾ç‰‡æ¼”ç¤º

![1.png](1.png)

![2.png](2.png)

![3.png](3.png)

##### æ³¨æ„ï¼šç”±äºæ­¤åšå®¢ç¼–è¾‘è¾ƒæ—©ï¼Œä¸Šé¢â€œ2.å›¾ç‰‡æ¼”ç¤ºâ€å’Œâ€œ3.è§†é¢‘æ¼”ç¤ºâ€å±•ç¤ºçš„ç³»ç»Ÿå›¾ç‰‡æˆ–è€…è§†é¢‘å¯èƒ½ä¸ºè€ç‰ˆæœ¬ï¼Œæ–°ç‰ˆæœ¬åœ¨è€ç‰ˆæœ¬çš„åŸºç¡€ä¸Šå‡çº§å¦‚ä¸‹ï¼šï¼ˆå®é™…æ•ˆæœä»¥å‡çº§çš„æ–°ç‰ˆæœ¬ä¸ºå‡†ï¼‰

  ï¼ˆ1ï¼‰é€‚é…äº†YOLOV8çš„â€œç›®æ ‡æ£€æµ‹â€æ¨¡å‹å’Œâ€œå®ä¾‹åˆ†å‰²â€æ¨¡å‹ï¼Œé€šè¿‡åŠ è½½ç›¸åº”çš„æƒé‡ï¼ˆ.ptï¼‰æ–‡ä»¶å³å¯è‡ªé€‚åº”åŠ è½½æ¨¡å‹ã€‚

  ï¼ˆ2ï¼‰æ”¯æŒâ€œå›¾ç‰‡è¯†åˆ«â€ã€â€œè§†é¢‘è¯†åˆ«â€ã€â€œæ‘„åƒå¤´å®æ—¶è¯†åˆ«â€ä¸‰ç§è¯†åˆ«æ¨¡å¼ã€‚

  ï¼ˆ3ï¼‰æ”¯æŒâ€œå›¾ç‰‡è¯†åˆ«â€ã€â€œè§†é¢‘è¯†åˆ«â€ã€â€œæ‘„åƒå¤´å®æ—¶è¯†åˆ«â€ä¸‰ç§è¯†åˆ«ç»“æœä¿å­˜å¯¼å‡ºï¼Œè§£å†³æ‰‹åŠ¨å¯¼å‡ºï¼ˆå®¹æ˜“å¡é¡¿å‡ºç°çˆ†å†…å­˜ï¼‰å­˜åœ¨çš„é—®é¢˜ï¼Œè¯†åˆ«å®Œè‡ªåŠ¨ä¿å­˜ç»“æœå¹¶å¯¼å‡ºåˆ°tempDirä¸­ã€‚

  ï¼ˆ4ï¼‰æ”¯æŒWebå‰ç«¯ç³»ç»Ÿä¸­çš„æ ‡é¢˜ã€èƒŒæ™¯å›¾ç­‰è‡ªå®šä¹‰ä¿®æ”¹ï¼Œåé¢æä¾›ä¿®æ”¹æ•™ç¨‹ã€‚

  å¦å¤–æœ¬é¡¹ç›®æä¾›è®­ç»ƒçš„æ•°æ®é›†å’Œè®­ç»ƒæ•™ç¨‹,æš‚ä¸æä¾›æƒé‡æ–‡ä»¶ï¼ˆbest.ptï¼‰,éœ€è¦æ‚¨æŒ‰ç…§æ•™ç¨‹è¿›è¡Œè®­ç»ƒåå®ç°å›¾ç‰‡æ¼”ç¤ºå’ŒWebå‰ç«¯ç•Œé¢æ¼”ç¤ºçš„æ•ˆæœã€‚

### 3.è§†é¢‘æ¼”ç¤º

[3.1 è§†é¢‘æ¼”ç¤º](https://www.bilibili.com/video/BV1kZ4deRE4f/)

### 4.æ•°æ®é›†ä¿¡æ¯å±•ç¤º

##### 4.1 æœ¬é¡¹ç›®æ•°æ®é›†è¯¦ç»†æ•°æ®ï¼ˆç±»åˆ«æ•°ï¼†ç±»åˆ«åï¼‰

nc: 21
names: ['Buldakbokkeummyeon_Keunkeop', 'Carbo_Buldakbokkeummyeon_Keunkeop', 'Chilsung_Cider', 'Coca_Cola', 'Doshirak', 'Jinlamyeon_Maeunmat', 'Jjapageti_Keunsabalmyeon', 'Kimchi_Sabalmyeon', 'Let_s_Be', 'MoGu_MoGU', 'Narangd_Cider', 'Neoguri_Keunsabalmyeon', 'POCARI_SWEAT', 'POWER_ADE_MEGA_BOLTZ', 'POWER_ADE_MOUNTAIN_BLAST', 'POWER_ADE_PURPLE_STORM', 'Picnic_Apple', 'Picnic_White_Grape', 'Sinlamyeon_Keunsabalmyeon', 'Wangttukkeong', 'Yukgaejang_Sabalmyeon']


##### 4.2 æœ¬é¡¹ç›®æ•°æ®é›†ä¿¡æ¯ä»‹ç»

æ•°æ®é›†ä¿¡æ¯å±•ç¤º

åœ¨æœ¬ç ”ç©¶ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†åä¸ºâ€œfidgeâ€çš„æ•°æ®é›†ï¼Œä»¥è®­ç»ƒå’Œæ”¹è¿›YOLOv8æ¨¡å‹åœ¨é£Ÿå“åŒ…è£…è¯†åˆ«ç³»ç»Ÿä¸­çš„è¡¨ç°ã€‚è¯¥æ•°æ®é›†ä¸“é—¨è®¾è®¡ç”¨äºè¯†åˆ«å’Œåˆ†ç±»å¤šç§é£Ÿå“åŒ…è£…ï¼Œå…·æœ‰21ä¸ªä¸åŒçš„ç±»åˆ«ï¼Œæ¶µç›–äº†å¹¿æ³›çš„é£Ÿå“å’Œé¥®æ–™äº§å“ã€‚è¿™äº›ç±»åˆ«ä¸ä»…åæ˜ äº†å¸‚åœºä¸Šå¸¸è§çš„å•†å“ï¼Œè¿˜å±•ç¤ºäº†ä¸åŒå“ç‰Œå’Œç±»å‹çš„å¤šæ ·æ€§ï¼Œä¸ºæ¨¡å‹çš„è®­ç»ƒæä¾›äº†ä¸°å¯Œçš„æ ·æœ¬ã€‚

å…·ä½“è€Œè¨€ï¼Œæ•°æ®é›†ä¸­åŒ…å«çš„ç±»åˆ«åŒ…æ‹¬ï¼šBuldakbokkeummyeon_Keunkeopã€Carbo_Buldakbokkeummyeon_Keunkeopã€Chilsung_Ciderã€Coca_Colaã€Doshirakã€Jinlamyeon_Maeunmatã€Jjapageti_Keunsabalmyeonã€Kimchi_Sabalmyeonã€Let_s_Beã€MoGu_MoGUã€Narangd_Ciderã€Neoguri_Keunsabalmyeonã€POCARI_SWEATã€POWER_ADE_MEGA_BOLTZã€POWER_ADE_MOUNTAIN_BLASTã€POWER_ADE_PURPLE_STORMã€Picnic_Appleã€Picnic_White_Grapeã€Sinlamyeon_Keunsabalmyeonã€Wangttukkeongä»¥åŠYukgaejang_Sabalmyeonã€‚è¿™äº›ç±»åˆ«æ¶µç›–äº†ä»æ–¹ä¾¿é¢ã€é¥®æ–™åˆ°å³é£Ÿé¤ç­‰å¤šç§é£Ÿå“ç±»å‹ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°åæ˜ å‡ºæ¶ˆè´¹è€…æ—¥å¸¸ç”Ÿæ´»ä¸­å¸¸è§çš„é€‰æ‹©ã€‚

æ•°æ®é›†çš„è®¾è®¡è€ƒè™‘åˆ°äº†å¤šæ ·æ€§å’Œä»£è¡¨æ€§ï¼Œä½¿å¾—æ¨¡å‹åœ¨å®é™…åº”ç”¨ä¸­èƒ½å¤Ÿå…·å¤‡æ›´å¼ºçš„è¯†åˆ«èƒ½åŠ›ã€‚ä¾‹å¦‚ï¼Œæ–¹ä¾¿é¢ç±»çš„äº§å“å¦‚Buldakbokkeummyeonå’ŒJjapagetiï¼Œå…·æœ‰ä¸åŒçš„åŒ…è£…è®¾è®¡å’Œè‰²å½©ï¼Œè¿™å¯¹æ¨¡å‹çš„è§†è§‰è¯†åˆ«èƒ½åŠ›æå‡ºäº†æŒ‘æˆ˜ã€‚è€Œé¥®æ–™ç±»çš„äº§å“å¦‚Chilsung_Ciderå’ŒCoca_Colaï¼Œåˆ™é€šè¿‡å…¶ç‹¬ç‰¹çš„ç“¶èº«å’Œæ ‡ç­¾è®¾è®¡ï¼Œä½¿å¾—æ¨¡å‹åœ¨è¯†åˆ«æ—¶éœ€è¦å…³æ³¨æ›´å¤šçš„ç»†èŠ‚ç‰¹å¾ã€‚

æ­¤å¤–ï¼Œæ•°æ®é›†ä¸­çš„æ¯ä¸ªç±»åˆ«éƒ½ç»è¿‡ç²¾å¿ƒæ ‡æ³¨ï¼Œç¡®ä¿åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæ¨¡å‹èƒ½å¤Ÿå­¦ä¹ åˆ°æ¯ç§é£Ÿå“åŒ…è£…çš„ç‹¬ç‰¹ç‰¹å¾ã€‚è¿™ç§ç²¾ç¡®çš„æ ‡æ³¨ä¸ä»…æé«˜äº†æ¨¡å‹çš„è®­ç»ƒæ•ˆç‡ï¼Œä¹Ÿå¢å¼ºäº†å…¶åœ¨å®é™…åº”ç”¨ä¸­çš„å‡†ç¡®æ€§ã€‚é€šè¿‡å¯¹â€œfidgeâ€æ•°æ®é›†çš„å……åˆ†åˆ©ç”¨ï¼Œæˆ‘ä»¬æœŸæœ›èƒ½å¤Ÿæ˜¾è‘—æå‡YOLOv8åœ¨é£Ÿå“åŒ…è£…è¯†åˆ«ä»»åŠ¡ä¸­çš„æ€§èƒ½ï¼Œä½¿å…¶åœ¨å¤šç§ç¯å¢ƒä¸‹éƒ½èƒ½ä¿æŒé«˜æ•ˆçš„è¯†åˆ«èƒ½åŠ›ã€‚

åœ¨æœªæ¥çš„ç ”ç©¶ä¸­ï¼Œæˆ‘ä»¬è¿˜è®¡åˆ’å¯¹æ•°æ®é›†è¿›è¡Œæ‰©å±•ï¼Œå¢åŠ æ›´å¤šçš„é£Ÿå“åŒ…è£…ç±»åˆ«ï¼Œä»¥è¿›ä¸€æ­¥æå‡æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›å’Œé€‚åº”æ€§ã€‚é€šè¿‡ä¸æ–­ä¸°å¯Œæ•°æ®é›†ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿåº”å¯¹å¸‚åœºä¸Šæ—¥ç›Šå˜åŒ–çš„é£Ÿå“åŒ…è£…è®¾è®¡ï¼Œç¡®ä¿æ¨¡å‹åœ¨å®é™…åº”ç”¨ä¸­çš„æŒç»­æœ‰æ•ˆæ€§å’Œå¯é æ€§ã€‚æ€»ä¹‹ï¼Œâ€œfidgeâ€æ•°æ®é›†ä¸ºæˆ‘ä»¬çš„ç ”ç©¶æä¾›äº†åšå®çš„åŸºç¡€ï¼Œä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿåœ¨é£Ÿå“åŒ…è£…è¯†åˆ«é¢†åŸŸå–å¾—æ›´å¤§çš„è¿›å±•ã€‚

![4.png](4.png)

![5.png](5.png)

![6.png](6.png)

![7.png](7.png)

![8.png](8.png)

### 5.å…¨å¥—é¡¹ç›®ç¯å¢ƒéƒ¨ç½²è§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰

[5.1 ç¯å¢ƒéƒ¨ç½²æ•™ç¨‹é“¾æ¥ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰](https://www.ixigua.com/7404473917358506534?logTag=c807d0cbc21c0ef59de5)




[5.2 å®‰è£…Pythonè™šæ‹Ÿç¯å¢ƒåˆ›å»ºå’Œä¾èµ–åº“å®‰è£…è§†é¢‘æ•™ç¨‹é“¾æ¥ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰](https://www.ixigua.com/7404474678003106304?logTag=1f1041108cd1f708b01a)

### 6.æ‰‹æŠŠæ‰‹YOLOV8è®­ç»ƒè§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€å°ç™½æœ‰æ‰‹å°±èƒ½å­¦ä¼šï¼‰

[6.1 æ‰‹æŠŠæ‰‹YOLOV8è®­ç»ƒè§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€å°ç™½æœ‰æ‰‹å°±èƒ½å­¦ä¼šï¼‰](https://www.ixigua.com/7404477157818401292?logTag=d31a2dfd1983c9668658)

### 7.70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹ä»£ç åŠ è½½è°ƒå‚è§†é¢‘æ•™ç¨‹ï¼ˆä¸€é”®åŠ è½½å†™å¥½çš„æ”¹è¿›æ¨¡å‹çš„é…ç½®æ–‡ä»¶ï¼‰

[7.1 70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹ä»£ç åŠ è½½è°ƒå‚è§†é¢‘æ•™ç¨‹ï¼ˆä¸€é”®åŠ è½½å†™å¥½çš„æ”¹è¿›æ¨¡å‹çš„é…ç½®æ–‡ä»¶ï¼‰](https://www.ixigua.com/7404478314661806627?logTag=29066f8288e3f4eea3a4)

### 8.70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹åŸç†è®²è§£ï¼ˆéç§‘ç­ä¹Ÿå¯ä»¥è½»æ¾å†™åˆŠå‘åˆŠï¼ŒV10ç‰ˆæœ¬æ­£åœ¨ç§‘ç ”å¾…æ›´æ–°ï¼‰

ç”±äºç¯‡å¹…é™åˆ¶ï¼Œæ¯ä¸ªåˆ›æ–°ç‚¹çš„å…·ä½“åŸç†è®²è§£å°±ä¸ä¸€ä¸€å±•å¼€ï¼Œå…·ä½“è§ä¸‹åˆ—ç½‘å€ä¸­çš„åˆ›æ–°ç‚¹å¯¹åº”å­é¡¹ç›®çš„æŠ€æœ¯åŸç†åšå®¢ç½‘å€ã€Blogã€‘ï¼š

![9.png](9.png)

[8.1 70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹åŸç†è®²è§£é“¾æ¥](https://gitee.com/qunmasj/good)

### 9.ç³»ç»ŸåŠŸèƒ½å±•ç¤ºï¼ˆæ£€æµ‹å¯¹è±¡ä¸ºä¸¾ä¾‹ï¼Œå®é™…å†…å®¹ä»¥æœ¬é¡¹ç›®æ•°æ®é›†ä¸ºå‡†ï¼‰

å›¾9.1.ç³»ç»Ÿæ”¯æŒæ£€æµ‹ç»“æœè¡¨æ ¼æ˜¾ç¤º

  å›¾9.2.ç³»ç»Ÿæ”¯æŒç½®ä¿¡åº¦å’ŒIOUé˜ˆå€¼æ‰‹åŠ¨è°ƒèŠ‚

  å›¾9.3.ç³»ç»Ÿæ”¯æŒè‡ªå®šä¹‰åŠ è½½æƒé‡æ–‡ä»¶best.pt(éœ€è¦ä½ é€šè¿‡æ­¥éª¤5ä¸­è®­ç»ƒè·å¾—)

  å›¾9.4.ç³»ç»Ÿæ”¯æŒæ‘„åƒå¤´å®æ—¶è¯†åˆ«

  å›¾9.5.ç³»ç»Ÿæ”¯æŒå›¾ç‰‡è¯†åˆ«

  å›¾9.6.ç³»ç»Ÿæ”¯æŒè§†é¢‘è¯†åˆ«

  å›¾9.7.ç³»ç»Ÿæ”¯æŒè¯†åˆ«ç»“æœæ–‡ä»¶è‡ªåŠ¨ä¿å­˜

  å›¾9.8.ç³»ç»Ÿæ”¯æŒExcelå¯¼å‡ºæ£€æµ‹ç»“æœæ•°æ®

![10.png](10.png)

![11.png](11.png)

![12.png](12.png)

![13.png](13.png)

![14.png](14.png)

![15.png](15.png)

![16.png](16.png)

![17.png](17.png)

### 10.åŸå§‹YOLOV8ç®—æ³•åŸç†

åŸå§‹YOLOv8ç®—æ³•åŸç†

YOLOv8ä½œä¸ºYOLOç³»åˆ—çš„æœ€æ–°ç‰ˆæœ¬ï¼Œæ ‡å¿—ç€ç›®æ ‡æ£€æµ‹æŠ€æœ¯çš„ä¸€æ¬¡é‡è¦é£è·ƒã€‚ä¸å…¶å‰èº«YOLOv5ç›¸æ¯”ï¼ŒYOLOv8åœ¨æ£€æµ‹ç²¾åº¦å’Œé€Ÿåº¦ä¸Šéƒ½å–å¾—äº†æ˜¾è‘—çš„æå‡ï¼Œå……åˆ†å±•ç¤ºäº†æ·±åº¦å­¦ä¹ åœ¨è®¡ç®—æœºè§†è§‰é¢†åŸŸçš„å¼ºå¤§æ½œåŠ›ã€‚YOLOv8çš„è®¾è®¡ç†å¿µæ˜¯é€šè¿‡ä¼˜åŒ–ç½‘ç»œç»“æ„å’Œç®—æ³•æµç¨‹ï¼Œæå‡æ¨¡å‹çš„å®æ—¶æ€§å’Œå‡†ç¡®æ€§ï¼Œä»¥é€‚åº”æ—¥ç›Šå¤æ‚çš„åº”ç”¨åœºæ™¯ã€‚

YOLOv8çš„ç½‘ç»œç»“æ„å¯ä»¥åˆ†ä¸ºå››ä¸ªä¸»è¦éƒ¨åˆ†ï¼šè¾“å…¥ç«¯ã€éª¨å¹²ç½‘ç»œã€é¢ˆéƒ¨ç½‘ç»œå’Œå¤´éƒ¨ç½‘ç»œã€‚è¾“å…¥ç«¯çš„è®¾è®¡æ—¨åœ¨å¯¹è¾“å…¥å›¾åƒè¿›è¡Œæœ‰æ•ˆçš„é¢„å¤„ç†ï¼Œä»¥ä¾¿ä¸ºåç»­çš„ç‰¹å¾æå–æ‰“ä¸‹è‰¯å¥½çš„åŸºç¡€ã€‚è¯¥éƒ¨åˆ†åŒ…æ‹¬é©¬èµ›å…‹æ•°æ®å¢å¼ºã€è‡ªé€‚åº”é”šæ¡†è®¡ç®—å’Œè‡ªé€‚åº”ç°åº¦å¡«å……ç­‰æŠ€æœ¯ï¼Œæ—¨åœ¨æå‡æ¨¡å‹å¯¹ä¸åŒåœºæ™¯å’Œå…‰ç…§æ¡ä»¶çš„é€‚åº”èƒ½åŠ›ã€‚é©¬èµ›å…‹å¢å¼ºé€šè¿‡å°†å¤šå¼ å›¾åƒæ‹¼æ¥åœ¨ä¸€èµ·ï¼Œå¢åŠ äº†è®­ç»ƒæ•°æ®çš„å¤šæ ·æ€§ï¼Œä»è€Œæå‡äº†æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚

éª¨å¹²ç½‘ç»œæ˜¯YOLOv8çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ï¼Œé‡‡ç”¨äº†C2fç»“æ„æ›¿ä»£äº†YOLOv5ä¸­çš„C3ç»“æ„ã€‚C2fæ¨¡å—é€šè¿‡å¼•å…¥æ›´å¤šçš„åˆ†æ”¯å’Œè·¨å±‚è¿æ¥ï¼Œå¢å¼ºäº†æ¨¡å‹çš„æ¢¯åº¦æµåŠ¨æ€§ï¼Œä½¿å¾—ç‰¹å¾å­¦ä¹ æ›´åŠ é«˜æ•ˆã€‚ç»“åˆSPPFï¼ˆSpatial Pyramid Pooling Fusionï¼‰æ¨¡å—ï¼ŒYOLOv8èƒ½å¤Ÿæœ‰æ•ˆåœ°å¤„ç†ä¸åŒå°ºåº¦çš„ç‰¹å¾å›¾ï¼Œä»è€Œæé«˜äº†å¯¹å¤šå°ºåº¦ç›®æ ‡çš„æ£€æµ‹èƒ½åŠ›ã€‚SPPFæ¨¡å—é€šè¿‡ä¸åŒå°ºå¯¸çš„æ± åŒ–æ“ä½œï¼Œèåˆäº†æ¥è‡ªä¸åŒå±‚æ¬¡çš„ç‰¹å¾ä¿¡æ¯ï¼Œè¿›ä¸€æ­¥ä¸°å¯Œäº†ç½‘ç»œçš„ç‰¹å¾è¡¨ç¤ºèƒ½åŠ›ã€‚

é¢ˆéƒ¨ç½‘ç»œé‡‡ç”¨äº†è·¯å¾„èšåˆç½‘ç»œï¼ˆPANï¼‰ç»“æ„ï¼Œè¿™ä¸€è®¾è®¡æ—¨åœ¨åŠ å¼ºä¸åŒå°ºåº¦ç‰¹å¾çš„èåˆèƒ½åŠ›ã€‚PANé€šè¿‡ç‰¹å¾é‡‘å­—å¡”å’Œè·¯å¾„èšåˆçš„ç»“åˆï¼Œä¿ƒè¿›äº†è¯­ä¹‰ä¿¡æ¯å’Œå®šä½ä¿¡æ¯çš„æœ‰æ•ˆè½¬ç§»ï¼Œä½¿å¾—YOLOv8åœ¨å¤„ç†ä¸åŒå¤§å°ç›®æ ‡æ—¶è¡¨ç°å¾—æ›´åŠ å‡ºè‰²ã€‚è¿™æ ·çš„è®¾è®¡ä¸ä»…æå‡äº†ç‰¹å¾èåˆçš„æ•ˆæœï¼Œè¿˜å¢å¼ºäº†æ¨¡å‹å¯¹å¤æ‚åœºæ™¯çš„é€‚åº”èƒ½åŠ›ï¼Œå°¤å…¶æ˜¯åœ¨å­˜åœ¨å¤šä¸ªç›®æ ‡çš„æƒ…å†µä¸‹ã€‚

å¤´éƒ¨ç½‘ç»œæ˜¯YOLOv8çš„æœ€åä¸€éƒ¨åˆ†ï¼Œå…¶è®¾è®¡ä¸Šå®ç°äº†åˆ†ç±»å’Œæ£€æµ‹è¿‡ç¨‹çš„è§£è€¦ã€‚ä¼ ç»Ÿçš„YOLOç³»åˆ—é€šå¸¸å°†åˆ†ç±»å’Œå›å½’ä»»åŠ¡è€¦åˆåœ¨ä¸€èµ·ï¼Œè€ŒYOLOv8åˆ™é‡‡ç”¨äº†è§£è€¦å¤´ç»“æ„ï¼Œå°†è¿™ä¸¤ä¸ªä»»åŠ¡åˆ†å¼€å¤„ç†ã€‚è¿™æ ·çš„è®¾è®¡ä½¿å¾—æ¨¡å‹åœ¨è¿›è¡Œç›®æ ‡æ£€æµ‹æ—¶ï¼Œèƒ½å¤Ÿæ›´åŠ ä¸“æ³¨äºå„è‡ªçš„ä»»åŠ¡ï¼Œå‡å°‘äº†ä»»åŠ¡é—´çš„å¹²æ‰°ï¼Œä»è€Œæå‡äº†æ£€æµ‹ç²¾åº¦ã€‚å¤´éƒ¨ç½‘ç»œä¸­ï¼ŒYOLOv8å¼•å…¥äº†Task-Aligned Assignerç­–ç•¥ï¼Œä»¥æ›´æœ‰æ•ˆåœ°åˆ†é…æ­£è´Ÿæ ·æœ¬ï¼Œå¹¶ç»“åˆäº†äºŒå…ƒäº¤å‰ç†µæŸå¤±å’Œåˆ†å¸ƒç„¦ç‚¹æŸå¤±ç­‰å¤šç§æŸå¤±å‡½æ•°ï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–äº†æ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹ã€‚

å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒYOLOv8é‡‡ç”¨äº†æ— é”šæ¡†ï¼ˆAnchor-Freeï¼‰æ£€æµ‹æ–¹æ³•ï¼Œè¿™ä¸€åˆ›æ–°æ€§è®¾è®¡ä½¿å¾—æ¨¡å‹ä¸å†ä¾èµ–äºé¢„å®šä¹‰çš„é”šæ¡†ï¼Œä»è€Œç®€åŒ–äº†ç›®æ ‡æ£€æµ‹çš„è¿‡ç¨‹ã€‚ä¼ ç»Ÿçš„é”šæ¡†æ–¹æ³•åœ¨å¤„ç†ä¸åŒå°ºåº¦å’Œå½¢çŠ¶çš„ç›®æ ‡æ—¶ï¼Œå¾€å¾€éœ€è¦è¿›è¡Œç¹ççš„é”šæ¡†é€‰æ‹©å’Œè°ƒæ•´ï¼Œè€ŒYOLOv8é€šè¿‡ç›´æ¥å›å½’ç›®æ ‡çš„ä½ç½®å’Œå¤§å°ï¼Œèƒ½å¤Ÿæ›´å¿«é€Ÿåœ°èšç„¦äºç›®æ ‡åŒºåŸŸã€‚è¿™ç§æ–¹æ³•ä¸ä»…æé«˜äº†æ£€æµ‹é€Ÿåº¦ï¼Œè¿˜å¢å¼ºäº†æ¨¡å‹å¯¹å„ç§ç›®æ ‡çš„é€‚åº”èƒ½åŠ›ï¼Œä½¿å¾—YOLOv8åœ¨å®æ—¶æ£€æµ‹ä»»åŠ¡ä¸­è¡¨ç°å¾—å°¤ä¸ºå‡ºè‰²ã€‚

åœ¨æ•´ä½“æ€§èƒ½ä¸Šï¼ŒYOLOv8é€šè¿‡ç²¾ç®€æ¨¡å‹ç»“æ„å’Œä¼˜åŒ–ç½‘ç»œå‚æ•°ï¼Œè¾¾åˆ°äº†è½»é‡åŒ–çš„æ•ˆæœï¼Œä½¿å¾—å…¶èƒ½å¤Ÿåœ¨åµŒå…¥å¼è®¾å¤‡ä¸Šé«˜æ•ˆè¿è¡Œã€‚è¿™ä¸€ç‰¹æ€§ä½¿å¾—YOLOv8ä¸ä»…é€‚ç”¨äºä¼ ç»Ÿçš„è®¡ç®—æœºè§†è§‰ä»»åŠ¡ï¼Œè¿˜èƒ½å¤Ÿå¹¿æ³›åº”ç”¨äºæ™ºèƒ½ç›‘æ§ã€è‡ªåŠ¨é©¾é©¶ã€æ— äººæœºç­‰é¢†åŸŸï¼Œæ»¡è¶³äº†å®æ—¶æ£€æµ‹çš„éœ€æ±‚ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼ŒYOLOv8é€šè¿‡å¯¹ç½‘ç»œç»“æ„çš„æ·±åº¦ä¼˜åŒ–å’Œç®—æ³•æµç¨‹çš„åˆ›æ–°ï¼Œå±•ç°äº†å…¶åœ¨ç›®æ ‡æ£€æµ‹é¢†åŸŸçš„å¼ºå¤§èƒ½åŠ›ã€‚å…¶ç‹¬ç‰¹çš„è®¾è®¡ç†å¿µå’Œé«˜æ•ˆçš„å®ç°æ–¹å¼ï¼Œä½¿å¾—YOLOv8æˆä¸ºäº†å½“å‰ç›®æ ‡æ£€æµ‹æŠ€æœ¯ä¸­çš„ä½¼ä½¼è€…ã€‚æ— è®ºæ˜¯åœ¨ç²¾åº¦ã€é€Ÿåº¦è¿˜æ˜¯é€‚åº”æ€§æ–¹é¢ï¼ŒYOLOv8éƒ½ä¸ºåç»­çš„ç ”ç©¶å’Œåº”ç”¨æä¾›äº†æ–°çš„æ€è·¯å’Œæ–¹å‘ï¼Œæ¨åŠ¨äº†è®¡ç®—æœºè§†è§‰æŠ€æœ¯çš„ä¸æ–­è¿›æ­¥ã€‚

![18.png](18.png)

### 11.é¡¹ç›®æ ¸å¿ƒæºç è®²è§£ï¼ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒçœ‹ä¸æ‡‚ä»£ç é€»è¾‘ï¼‰

#### 11.1 code\ultralytics\nn\modules\utils.py

ä»¥ä¸‹æ˜¯å¯¹ç»™å®šä»£ç çš„æ ¸å¿ƒéƒ¨åˆ†è¿›è¡Œåˆ†æå’Œè¯¦ç»†æ³¨é‡Šçš„ç»“æœï¼š

```python
# Ultralytics YOLO ğŸš€, AGPL-3.0 license
"""æ¨¡å— utils."""

import copy
import math
import numpy as np
import torch
import torch.nn as nn
import torch.nn.functional as F
from torch.nn.init import uniform_

__all__ = "multi_scale_deformable_attn_pytorch", "inverse_sigmoid"

def inverse_sigmoid(x, eps=1e-5):
    """è®¡ç®—å¼ é‡çš„å sigmoid å‡½æ•°ã€‚

    å‚æ•°:
        x (torch.Tensor): è¾“å…¥å¼ é‡ï¼Œå€¼åº”åœ¨ [0, 1] èŒƒå›´å†…ã€‚
        eps (float): é˜²æ­¢é™¤é›¶çš„æœ€å°å€¼ã€‚

    è¿”å›:
        torch.Tensor: å sigmoid è®¡ç®—ç»“æœã€‚
    """
    # é™åˆ¶ x çš„å€¼åœ¨ 0 åˆ° 1 ä¹‹é—´
    x = x.clamp(min=0, max=1)
    # é˜²æ­¢è®¡ç®—æ—¶å‡ºç°é›¶
    x1 = x.clamp(min=eps)
    x2 = (1 - x).clamp(min=eps)
    # è®¡ç®—å sigmoid
    return torch.log(x1 / x2)

def multi_scale_deformable_attn_pytorch(
    value: torch.Tensor,
    value_spatial_shapes: torch.Tensor,
    sampling_locations: torch.Tensor,
    attention_weights: torch.Tensor,
) -> torch.Tensor:
    """
    å¤šå°ºåº¦å¯å˜å½¢æ³¨æ„åŠ›æœºåˆ¶ã€‚

    å‚æ•°:
        value (torch.Tensor): è¾“å…¥ç‰¹å¾ï¼Œå½¢çŠ¶ä¸º (bs, C, num_heads, embed_dims)ã€‚
        value_spatial_shapes (torch.Tensor): ç‰¹å¾å›¾çš„ç©ºé—´å½¢çŠ¶ã€‚
        sampling_locations (torch.Tensor): é‡‡æ ·ä½ç½®ï¼Œå½¢çŠ¶ä¸º (bs, num_queries, num_heads, num_levels, num_points, 2)ã€‚
        attention_weights (torch.Tensor): æ³¨æ„åŠ›æƒé‡ï¼Œå½¢çŠ¶ä¸º (bs, num_heads, num_queries, num_levels, num_points)ã€‚

    è¿”å›:
        torch.Tensor: è¾“å‡ºç‰¹å¾ï¼Œå½¢çŠ¶ä¸º (bs, num_queries, num_heads * embed_dims)ã€‚
    """
    # è·å–è¾“å…¥çš„ç»´åº¦ä¿¡æ¯
    bs, _, num_heads, embed_dims = value.shape
    _, num_queries, _, num_levels, num_points, _ = sampling_locations.shape

    # å°†è¾“å…¥ç‰¹å¾æ ¹æ®ç©ºé—´å½¢çŠ¶åˆ†å‰²æˆå¤šä¸ªç‰¹å¾å›¾
    value_list = value.split([H_ * W_ for H_, W_ in value_spatial_shapes], dim=1)
    # å°†é‡‡æ ·ä½ç½®æ˜ å°„åˆ° [-1, 1] èŒƒå›´
    sampling_grids = 2 * sampling_locations - 1
    sampling_value_list = []

    # éå†æ¯ä¸ªå°ºåº¦çš„ç‰¹å¾å›¾
    for level, (H_, W_) in enumerate(value_spatial_shapes):
        # å¤„ç†å½“å‰å°ºåº¦çš„ç‰¹å¾å›¾
        value_l_ = value_list[level].flatten(2).transpose(1, 2).reshape(bs * num_heads, embed_dims, H_, W_)
        # è·å–å½“å‰å°ºåº¦çš„é‡‡æ ·ç½‘æ ¼
        sampling_grid_l_ = sampling_grids[:, :, :, level].transpose(1, 2).flatten(0, 1)
        # ä½¿ç”¨åŒçº¿æ€§æ’å€¼ä»ç‰¹å¾å›¾ä¸­é‡‡æ ·
        sampling_value_l_ = F.grid_sample(
            value_l_, sampling_grid_l_, mode="bilinear", padding_mode="zeros", align_corners=False
        )
        sampling_value_list.append(sampling_value_l_)

    # å¤„ç†æ³¨æ„åŠ›æƒé‡çš„å½¢çŠ¶
    attention_weights = attention_weights.transpose(1, 2).reshape(
        bs * num_heads, 1, num_queries, num_levels * num_points
    )
    
    # è®¡ç®—æœ€ç»ˆè¾“å‡º
    output = (
        (torch.stack(sampling_value_list, dim=-2).flatten(-2) * attention_weights)
        .sum(-1)
        .view(bs, num_heads * embed_dims, num_queries)
    )
    
    return output.transpose(1, 2).contiguous()
```

### ä»£ç åˆ†æä¸æ³¨é‡Š
1. **å sigmoid å‡½æ•°** (`inverse_sigmoid`):
   - è¯¥å‡½æ•°ç”¨äºè®¡ç®—è¾“å…¥å¼ é‡çš„å sigmoid å€¼ï¼Œç¡®ä¿è¾“å…¥å€¼åœ¨ [0, 1] èŒƒå›´å†…ï¼Œå¹¶é€šè¿‡ `eps` å‚æ•°é¿å…é™¤é›¶é”™è¯¯ã€‚

2. **å¤šå°ºåº¦å¯å˜å½¢æ³¨æ„åŠ›æœºåˆ¶** (`multi_scale_deformable_attn_pytorch`):
   - è¯¥å‡½æ•°å®ç°äº†å¤šå°ºåº¦çš„å¯å˜å½¢æ³¨æ„åŠ›æœºåˆ¶ï¼Œé€‚ç”¨äºç‰¹å¾å›¾çš„é‡‡æ ·å’ŒåŠ æƒã€‚
   - è¾“å…¥åŒ…æ‹¬ç‰¹å¾å€¼ã€ç‰¹å¾å›¾çš„ç©ºé—´å½¢çŠ¶ã€é‡‡æ ·ä½ç½®å’Œæ³¨æ„åŠ›æƒé‡ã€‚
   - é€šè¿‡åŒçº¿æ€§æ’å€¼ä»ä¸åŒå°ºåº¦çš„ç‰¹å¾å›¾ä¸­é‡‡æ ·ï¼Œå¹¶æ ¹æ®æ³¨æ„åŠ›æƒé‡åŠ æƒè¿™äº›é‡‡æ ·å€¼ï¼Œæœ€ç»ˆè¾“å‡ºåˆå¹¶åçš„ç‰¹å¾ã€‚

### æ€»ç»“
ä»¥ä¸Šä»£ç å®ç°äº†å sigmoid å‡½æ•°å’Œå¤šå°ºåº¦å¯å˜å½¢æ³¨æ„åŠ›æœºåˆ¶çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œé€‚ç”¨äºæ·±åº¦å­¦ä¹ æ¨¡å‹ä¸­çš„ç‰¹å¾å¤„ç†å’Œæ³¨æ„åŠ›æœºåˆ¶ã€‚é€šè¿‡è¯¦ç»†çš„æ³¨é‡Šï¼Œä¾¿äºç†è§£æ¯ä¸ªå‡½æ•°çš„è¾“å…¥ã€è¾“å‡ºåŠå…¶åŠŸèƒ½ã€‚

è¿™ä¸ªæ–‡ä»¶æ˜¯Ultralytics YOLOé¡¹ç›®ä¸­çš„ä¸€ä¸ªå·¥å…·æ¨¡å—ï¼Œä¸»è¦ç”¨äºå®šä¹‰ä¸€äº›æ·±åº¦å­¦ä¹ æ¨¡å‹ä¸­å¸¸ç”¨çš„å‡½æ•°å’Œæ“ä½œã€‚ä»£ç ä¸­åŒ…å«äº†å¤šä¸ªåŠŸèƒ½å‡½æ•°ï¼Œä¸‹é¢å¯¹è¿™äº›å‡½æ•°é€ä¸€è¿›è¡Œè¯´æ˜ã€‚

é¦–å…ˆï¼Œæ–‡ä»¶å¯¼å…¥äº†ä¸€äº›å¿…è¦çš„åº“ï¼ŒåŒ…æ‹¬`copy`ã€`math`ã€`numpy`å’Œ`torch`ç­‰ï¼Œè¿™äº›åº“æä¾›äº†æ·±åº¦å­¦ä¹ æ‰€éœ€çš„åŸºæœ¬åŠŸèƒ½å’Œæ•°å­¦è¿ç®—æ”¯æŒã€‚

æ¥ä¸‹æ¥ï¼Œå®šä¹‰äº†ä¸€ä¸ªåä¸º`_get_clones`çš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°æ¥æ”¶ä¸€ä¸ªæ¨¡å—å’Œä¸€ä¸ªæ•´æ•°nä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªåŒ…å«nä¸ªæ·±åº¦å¤åˆ¶æ¨¡å—çš„åˆ—è¡¨ã€‚è¿™åœ¨æ„å»ºæ¨¡å‹æ—¶éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦å¤šä¸ªç›¸åŒå±‚çš„æƒ…å†µä¸‹ã€‚

ç„¶åæ˜¯`bias_init_with_prob`å‡½æ•°ï¼Œå®ƒç”¨äºæ ¹æ®ç»™å®šçš„å…ˆéªŒæ¦‚ç‡åˆå§‹åŒ–å·ç§¯æˆ–å…¨è¿æ¥å±‚çš„åç½®å€¼ã€‚è¿™ä¸ªå‡½æ•°çš„å®ç°é€šè¿‡è®¡ç®—ç»™å®šæ¦‚ç‡çš„å¯¹æ•°å‡ ç‡æ¥è¿”å›åç½®çš„åˆå§‹å€¼ã€‚

`linear_init`å‡½æ•°ç”¨äºåˆå§‹åŒ–çº¿æ€§æ¨¡å—çš„æƒé‡å’Œåç½®ã€‚å®ƒæ ¹æ®æ¨¡å—çš„æƒé‡å½¢çŠ¶è®¡ç®—ä¸€ä¸ªè¾¹ç•Œå€¼ï¼Œå¹¶ä½¿ç”¨å‡åŒ€åˆ†å¸ƒåˆå§‹åŒ–æƒé‡å’Œåç½®ã€‚è¿™æœ‰åŠ©äºåœ¨è®­ç»ƒå¼€å§‹æ—¶æä¾›ä¸€ä¸ªåˆç†çš„å‚æ•°åˆå§‹åŒ–ã€‚

`inverse_sigmoid`å‡½æ•°è®¡ç®—è¾“å…¥å¼ é‡çš„åsigmoidå‡½æ•°ã€‚å®ƒé¦–å…ˆå°†è¾“å…¥é™åˆ¶åœ¨0åˆ°1ä¹‹é—´ï¼Œç„¶åè®¡ç®—åsigmoidå€¼ï¼Œé¿å…äº†æ•°å€¼ä¸ç¨³å®šçš„é—®é¢˜ã€‚

æœ€åï¼Œ`multi_scale_deformable_attn_pytorch`å‡½æ•°å®ç°äº†å¤šå°ºåº¦å¯å˜å½¢æ³¨æ„åŠ›æœºåˆ¶ã€‚è¿™ä¸ªå‡½æ•°çš„è¾“å…¥åŒ…æ‹¬å€¼å¼ é‡ã€ç©ºé—´å½¢çŠ¶ã€é‡‡æ ·ä½ç½®å’Œæ³¨æ„åŠ›æƒé‡ã€‚å®ƒé¦–å…ˆå¯¹è¾“å…¥çš„å€¼è¿›è¡Œåˆ†å‰²ï¼Œå¹¶è®¡ç®—é‡‡æ ·ç½‘æ ¼ã€‚æ¥ç€ï¼Œå‡½æ•°é€šè¿‡`F.grid_sample`æ–¹æ³•åœ¨ä¸åŒçš„å°ºåº¦ä¸Šå¯¹å€¼è¿›è¡Œé‡‡æ ·ï¼Œå¾—åˆ°ä¸åŒå±‚æ¬¡çš„ç‰¹å¾ã€‚æœ€åï¼Œå‡½æ•°å°†é‡‡æ ·å¾—åˆ°çš„ç‰¹å¾ä¸æ³¨æ„åŠ›æƒé‡ç»“åˆï¼Œè¾“å‡ºæœ€ç»ˆçš„æ³¨æ„åŠ›ç»“æœã€‚

æ•´ä½“æ¥çœ‹ï¼Œè¿™ä¸ªæ–‡ä»¶æä¾›äº†ä¸€äº›æ·±åº¦å­¦ä¹ æ¨¡å‹ä¸­å¸¸ç”¨çš„å·¥å…·å‡½æ•°ï¼Œå°¤å…¶æ˜¯åœ¨å®ç°å¤æ‚çš„æ³¨æ„åŠ›æœºåˆ¶æ—¶ï¼Œè¿™äº›å‡½æ•°å¯ä»¥å¸®åŠ©ç®€åŒ–ä»£ç å¹¶æé«˜å¯è¯»æ€§ã€‚

#### 11.2 70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\nn\backbone\SwinTransformer.py

ä»¥ä¸‹æ˜¯ç»è¿‡ç®€åŒ–å’Œæ³¨é‡Šçš„æ ¸å¿ƒä»£ç éƒ¨åˆ†ï¼Œä¸»è¦åŒ…æ‹¬Swin Transformerçš„ç»“æ„å’ŒåŠŸèƒ½æ¨¡å—ã€‚

```python
import torch
import torch.nn as nn
import torch.nn.functional as F
import numpy as np

class Mlp(nn.Module):
    """ å¤šå±‚æ„ŸçŸ¥æœº (MLP) æ¨¡å— """

    def __init__(self, in_features, hidden_features=None, out_features=None, act_layer=nn.GELU, drop=0.):
        super().__init__()
        out_features = out_features or in_features  # è¾“å‡ºç‰¹å¾æ•°
        hidden_features = hidden_features or in_features  # éšè—å±‚ç‰¹å¾æ•°
        self.fc1 = nn.Linear(in_features, hidden_features)  # ç¬¬ä¸€å±‚çº¿æ€§å˜æ¢
        self.act = act_layer()  # æ¿€æ´»å‡½æ•°
        self.fc2 = nn.Linear(hidden_features, out_features)  # ç¬¬äºŒå±‚çº¿æ€§å˜æ¢
        self.drop = nn.Dropout(drop)  # Dropoutå±‚

    def forward(self, x):
        """ å‰å‘ä¼ æ’­ """
        x = self.fc1(x)  # çº¿æ€§å˜æ¢
        x = self.act(x)  # æ¿€æ´»
        x = self.drop(x)  # Dropout
        x = self.fc2(x)  # çº¿æ€§å˜æ¢
        x = self.drop(x)  # Dropout
        return x


class WindowAttention(nn.Module):
    """ çª—å£æ³¨æ„åŠ›æœºåˆ¶æ¨¡å— """

    def __init__(self, dim, window_size, num_heads, qkv_bias=True, attn_drop=0., proj_drop=0.):
        super().__init__()
        self.dim = dim  # è¾“å…¥é€šé“æ•°
        self.window_size = window_size  # çª—å£å¤§å°
        self.num_heads = num_heads  # æ³¨æ„åŠ›å¤´æ•°
        head_dim = dim // num_heads  # æ¯ä¸ªå¤´çš„ç»´åº¦
        self.scale = head_dim ** -0.5  # ç¼©æ”¾å› å­

        # å®šä¹‰ç›¸å¯¹ä½ç½®åç½®å‚æ•°
        self.relative_position_bias_table = nn.Parameter(
            torch.zeros((2 * window_size[0] - 1) * (2 * window_size[1] - 1), num_heads))

        # è®¡ç®—ç›¸å¯¹ä½ç½®ç´¢å¼•
        coords_h = torch.arange(self.window_size[0])
        coords_w = torch.arange(self.window_size[1])
        coords = torch.stack(torch.meshgrid([coords_h, coords_w]))  # ç”Ÿæˆåæ ‡ç½‘æ ¼
        coords_flatten = torch.flatten(coords, 1)  # å±•å¹³åæ ‡
        relative_coords = coords_flatten[:, :, None] - coords_flatten[:, None, :]  # è®¡ç®—ç›¸å¯¹åæ ‡
        relative_coords = relative_coords.permute(1, 2, 0).contiguous()  # è°ƒæ•´ç»´åº¦
        relative_coords[:, :, 0] += self.window_size[0] - 1  # ä½ç½®åç§»
        relative_coords[:, :, 1] += self.window_size[1] - 1
        relative_coords[:, :, 0] *= 2 * self.window_size[1] - 1
        self.relative_position_index = relative_coords.sum(-1)  # è®¡ç®—ç›¸å¯¹ä½ç½®ç´¢å¼•

        self.qkv = nn.Linear(dim, dim * 3, bias=qkv_bias)  # çº¿æ€§å˜æ¢ç”ŸæˆQã€Kã€V
        self.attn_drop = nn.Dropout(attn_drop)  # æ³¨æ„åŠ›æƒé‡çš„Dropout
        self.proj = nn.Linear(dim, dim)  # è¾“å‡ºçº¿æ€§å˜æ¢
        self.proj_drop = nn.Dropout(proj_drop)  # è¾“å‡ºçš„Dropout
        self.softmax = nn.Softmax(dim=-1)  # Softmaxå±‚

    def forward(self, x, mask=None):
        """ å‰å‘ä¼ æ’­ """
        B_, N, C = x.shape  # B_: æ‰¹é‡å¤§å°, N: çª—å£å†…çš„tokenæ•°, C: é€šé“æ•°
        qkv = self.qkv(x).reshape(B_, N, 3, self.num_heads, C // self.num_heads).permute(2, 0, 3, 1, 4)
        q, k, v = qkv[0], qkv[1], qkv[2]  # åˆ†ç¦»Qã€Kã€V

        q = q * self.scale  # ç¼©æ”¾Q
        attn = (q @ k.transpose(-2, -1))  # è®¡ç®—æ³¨æ„åŠ›å¾—åˆ†

        # æ·»åŠ ç›¸å¯¹ä½ç½®åç½®
        relative_position_bias = self.relative_position_bias_table[self.relative_position_index.view(-1)].view(
            self.window_size[0] * self.window_size[1], self.window_size[0] * self.window_size[1], -1)
        relative_position_bias = relative_position_bias.permute(2, 0, 1).contiguous()  # è°ƒæ•´ç»´åº¦
        attn = attn + relative_position_bias.unsqueeze(0)  # åŠ å…¥åç½®

        attn = self.softmax(attn)  # Softmaxå½’ä¸€åŒ–
        attn = self.attn_drop(attn)  # Dropout

        x = (attn @ v).transpose(1, 2).reshape(B_, N, C)  # è®¡ç®—è¾“å‡º
        x = self.proj(x)  # è¾“å‡ºçº¿æ€§å˜æ¢
        x = self.proj_drop(x)  # Dropout
        return x


class SwinTransformer(nn.Module):
    """ Swin Transformer ä¸»ä½“ """

    def __init__(self, embed_dim=96, depths=[2, 2, 6, 2], num_heads=[3, 6, 12, 24], window_size=7):
        super().__init__()
        self.embed_dim = embed_dim  # åµŒå…¥ç»´åº¦
        self.layers = nn.ModuleList()  # å­˜å‚¨å„å±‚

        # æ„å»ºå„å±‚
        for i_layer in range(len(depths)):
            layer = BasicLayer(
                dim=int(embed_dim * 2 ** i_layer),
                depth=depths[i_layer],
                num_heads=num_heads[i_layer],
                window_size=window_size)
            self.layers.append(layer)

    def forward(self, x):
        """ å‰å‘ä¼ æ’­ """
        for layer in self.layers:
            x = layer(x)  # é€å±‚ä¼ é€’
        return x

# Swin Transformerçš„å®ä¾‹åŒ–
def SwinTransformer_Tiny():
    model = SwinTransformer(depths=[2, 2, 6, 2], num_heads=[3, 6, 12, 24])
    return model
```

### ä»£ç æ³¨é‡Šè¯´æ˜
1. **Mlpç±»**ï¼šå®ç°äº†ä¸€ä¸ªå¤šå±‚æ„ŸçŸ¥æœºï¼ŒåŒ…å«ä¸¤å±‚çº¿æ€§å˜æ¢å’Œæ¿€æ´»å‡½æ•°ï¼Œæ”¯æŒDropoutã€‚
2. **WindowAttentionç±»**ï¼šå®ç°äº†çª—å£æ³¨æ„åŠ›æœºåˆ¶ï¼Œæ”¯æŒç›¸å¯¹ä½ç½®åç½®çš„è®¡ç®—å’Œåº”ç”¨ã€‚
3. **SwinTransformerç±»**ï¼šæ„å»ºäº†Swin Transformerçš„ä¸»ä½“ç»“æ„ï¼ŒåŒ…å«å¤šä¸ªåŸºæœ¬å±‚ï¼ˆBasicLayerï¼‰ï¼Œæ¯ä¸ªå±‚ç”±çª—å£æ³¨æ„åŠ›å’ŒMLPç»„æˆã€‚
4. **SwinTransformer_Tinyå‡½æ•°**ï¼šç”¨äºåˆ›å»ºä¸€ä¸ªå°å‹çš„Swin Transformeræ¨¡å‹å®ä¾‹ã€‚

è¯¥ä»£ç å±•ç¤ºäº†Swin Transformerçš„åŸºæœ¬æ„é€ å’Œæ³¨æ„åŠ›æœºåˆ¶çš„å®ç°ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶å®ç°äº†Swin Transformeræ¨¡å‹çš„å„ä¸ªç»„ä»¶ï¼Œä¸»è¦ç”¨äºè®¡ç®—æœºè§†è§‰ä»»åŠ¡ä¸­çš„ç‰¹å¾æå–ã€‚Swin Transformeræ˜¯ä¸€ç§å±‚æ¬¡åŒ–çš„è§†è§‰Transformeræ¶æ„ï¼Œé‡‡ç”¨äº†çª—å£æ³¨æ„åŠ›æœºåˆ¶ï¼Œé€šè¿‡åˆ†å—å¤„ç†å›¾åƒæ¥æé«˜è®¡ç®—æ•ˆç‡å’Œæ•ˆæœã€‚

é¦–å…ˆï¼Œæ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€ä¸ªå¤šå±‚æ„ŸçŸ¥æœºï¼ˆMlpï¼‰ç±»ï¼ŒåŒ…å«ä¸¤ä¸ªçº¿æ€§å±‚å’Œä¸€ä¸ªæ¿€æ´»å‡½æ•°ï¼ˆé»˜è®¤ä¸ºGELUï¼‰ï¼Œå¹¶åœ¨æ¯ä¸ªçº¿æ€§å±‚åæ·»åŠ äº†Dropoutä»¥é˜²æ­¢è¿‡æ‹Ÿåˆã€‚æ¥ç€ï¼Œå®šä¹‰äº†ä¸¤ä¸ªå‡½æ•°ï¼š`window_partition`å’Œ`window_reverse`ï¼Œåˆ†åˆ«ç”¨äºå°†è¾“å…¥ç‰¹å¾åˆ†å‰²æˆçª—å£å’Œå°†çª—å£åˆå¹¶å›åŸå§‹ç‰¹å¾å›¾ã€‚

æ¥ä¸‹æ¥ï¼Œ`WindowAttention`ç±»å®ç°äº†åŸºäºçª—å£çš„å¤šå¤´è‡ªæ³¨æ„åŠ›æœºåˆ¶ã€‚å®ƒæ”¯æŒç›¸å¯¹ä½ç½®åç½®ï¼Œå¹¶ä¸”å¯ä»¥å¤„ç†ç§»ä½çª—å£ã€‚è¯¥ç±»çš„æ„é€ å‡½æ•°ä¸­å®šä¹‰äº†ç›¸å¯¹ä½ç½®åç½®è¡¨ï¼Œå¹¶è®¡ç®—äº†æ¯ä¸ªtokenä¹‹é—´çš„ç›¸å¯¹ä½ç½®ç´¢å¼•ã€‚å‰å‘ä¼ æ’­æ–¹æ³•ä¸­ï¼Œè¾“å…¥ç‰¹å¾ç»è¿‡çº¿æ€§å˜æ¢ç”ŸæˆæŸ¥è¯¢ã€é”®ã€å€¼ï¼Œè®¡ç®—æ³¨æ„åŠ›æƒé‡ï¼Œå¹¶åº”ç”¨ç›¸å¯¹ä½ç½®åç½®ã€‚

`SwinTransformerBlock`ç±»æ˜¯Swin Transformerçš„åŸºæœ¬æ„å»ºå—ï¼ŒåŒ…å«äº†çª—å£æ³¨æ„åŠ›å’Œå‰é¦ˆç½‘ç»œã€‚å®ƒæ”¯æŒå¾ªç¯ç§»ä½æ“ä½œä»¥å®ç°SW-MSAï¼ˆShifted Window Multi-Head Self-Attentionï¼‰ï¼Œå¹¶åœ¨å‰å‘ä¼ æ’­ä¸­å¤„ç†è¾“å…¥ç‰¹å¾çš„è§„èŒƒåŒ–ã€çª—å£åˆ†å‰²ã€æ³¨æ„åŠ›è®¡ç®—å’Œç‰¹å¾åˆå¹¶ã€‚

`PatchMerging`ç±»ç”¨äºå°†ç‰¹å¾å›¾ä¸­çš„patchè¿›è¡Œåˆå¹¶ï¼Œä»¥å‡å°ç‰¹å¾å›¾çš„å°ºå¯¸å¹¶å¢åŠ é€šé“æ•°ã€‚`BasicLayer`ç±»è¡¨ç¤ºSwin Transformerä¸­çš„ä¸€ä¸ªåŸºæœ¬å±‚ï¼ŒåŒ…å«å¤šä¸ªSwin Transformerå—ï¼Œå¹¶åœ¨å¿…è¦æ—¶è¿›è¡Œä¸‹é‡‡æ ·ã€‚

`PatchEmbed`ç±»è´Ÿè´£å°†è¾“å…¥å›¾åƒåˆ†å‰²æˆpatchå¹¶è¿›è¡ŒåµŒå…¥ï¼Œä½¿ç”¨å·ç§¯å±‚è¿›è¡Œçº¿æ€§æŠ•å½±ã€‚`SwinTransformer`ç±»åˆ™æ˜¯æ•´ä¸ªæ¨¡å‹çš„ä¸»ä½“ï¼Œè´Ÿè´£æ„å»ºå„ä¸ªå±‚æ¬¡ï¼Œå¤„ç†è¾“å…¥å›¾åƒï¼Œå¹¶è¾“å‡ºç‰¹å¾ã€‚

æœ€åï¼Œ`update_weight`å‡½æ•°ç”¨äºæ›´æ–°æ¨¡å‹æƒé‡ï¼Œ`SwinTransformer_Tiny`å‡½æ•°åˆ™åˆ›å»ºä¸€ä¸ªå°å‹çš„Swin Transformeræ¨¡å‹ï¼Œå¹¶åœ¨æä¾›æƒé‡æ–‡ä»¶æ—¶åŠ è½½æƒé‡ã€‚

æ•´ä½“æ¥çœ‹ï¼Œè¿™ä¸ªæ–‡ä»¶å®ç°äº†Swin Transformerçš„æ ¸å¿ƒç»„ä»¶ï¼Œé€‚ç”¨äºå›¾åƒåˆ†ç±»ã€ç›®æ ‡æ£€æµ‹ç­‰è®¡ç®—æœºè§†è§‰ä»»åŠ¡ã€‚

#### 11.3 ui.py

```python
import sys
import subprocess

def run_script(script_path):
    """
    ä½¿ç”¨å½“å‰ Python ç¯å¢ƒè¿è¡ŒæŒ‡å®šçš„è„šæœ¬ã€‚

    Args:
        script_path (str): è¦è¿è¡Œçš„è„šæœ¬è·¯å¾„

    Returns:
        None
    """
    # è·å–å½“å‰ Python è§£é‡Šå™¨çš„è·¯å¾„
    python_path = sys.executable

    # æ„å»ºè¿è¡Œå‘½ä»¤
    command = f'"{python_path}" -m streamlit run "{script_path}"'

    # æ‰§è¡Œå‘½ä»¤
    result = subprocess.run(command, shell=True)
    if result.returncode != 0:
        print("è„šæœ¬è¿è¡Œå‡ºé”™ã€‚")


# å®ä¾‹åŒ–å¹¶è¿è¡Œåº”ç”¨
if __name__ == "__main__":
    # æŒ‡å®šæ‚¨çš„è„šæœ¬è·¯å¾„
    script_path = "web.py"  # è¿™é‡Œå¯ä»¥ç›´æ¥æŒ‡å®šè„šæœ¬è·¯å¾„

    # è¿è¡Œè„šæœ¬
    run_script(script_path)
```

### ä»£ç æ ¸å¿ƒéƒ¨åˆ†åŠæ³¨é‡Š

1. **å¯¼å…¥å¿…è¦çš„æ¨¡å—**ï¼š
   - `sys`: ç”¨äºè®¿é—®ä¸ Python è§£é‡Šå™¨ç›¸å…³çš„å˜é‡å’Œå‡½æ•°ã€‚
   - `subprocess`: ç”¨äºåˆ›å»ºæ–°è¿›ç¨‹ã€è¿æ¥åˆ°å®ƒä»¬çš„è¾“å…¥/è¾“å‡º/é”™è¯¯ç®¡é“ï¼Œå¹¶è·å¾—è¿”å›ç ã€‚

2. **å®šä¹‰ `run_script` å‡½æ•°**ï¼š
   - è¯¥å‡½æ•°æ¥æ”¶ä¸€ä¸ªå‚æ•° `script_path`ï¼Œè¡¨ç¤ºè¦è¿è¡Œçš„ Python è„šæœ¬çš„è·¯å¾„ã€‚
   - ä½¿ç”¨ `sys.executable` è·å–å½“å‰ Python è§£é‡Šå™¨çš„è·¯å¾„ï¼Œä»¥ç¡®ä¿ä½¿ç”¨ç›¸åŒçš„ç¯å¢ƒè¿è¡Œè„šæœ¬ã€‚
   - æ„å»ºä¸€ä¸ªå‘½ä»¤å­—ç¬¦ä¸²ï¼Œä½¿ç”¨ `streamlit` æ¨¡å—è¿è¡ŒæŒ‡å®šçš„è„šæœ¬ã€‚
   - ä½¿ç”¨ `subprocess.run` æ‰§è¡Œæ„å»ºçš„å‘½ä»¤ï¼Œå¹¶æ£€æŸ¥è¿”å›ç ä»¥ç¡®å®šè„šæœ¬æ˜¯å¦æˆåŠŸè¿è¡Œã€‚

3. **ä¸»ç¨‹åºå…¥å£**ï¼š
   - åœ¨ `if __name__ == "__main__":` å—ä¸­ï¼ŒæŒ‡å®šè¦è¿è¡Œçš„è„šæœ¬è·¯å¾„ï¼ˆè¿™é‡Œä¸º `"web.py"`ï¼‰ã€‚
   - è°ƒç”¨ `run_script` å‡½æ•°æ¥æ‰§è¡ŒæŒ‡å®šçš„è„šæœ¬ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶åä¸º `ui.py`ï¼Œä¸»è¦åŠŸèƒ½æ˜¯ä½¿ç”¨å½“å‰çš„ Python ç¯å¢ƒæ¥è¿è¡Œä¸€ä¸ªæŒ‡å®šçš„è„šæœ¬ã€‚ä»£ç é¦–å…ˆå¯¼å…¥äº†å¿…è¦çš„æ¨¡å—ï¼ŒåŒ…æ‹¬ `sys`ã€`os` å’Œ `subprocess`ï¼Œä»¥åŠä¸€ä¸ªè‡ªå®šä¹‰çš„ `abs_path` å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å¯èƒ½ç”¨äºè·å–æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ã€‚

åœ¨ `run_script` å‡½æ•°ä¸­ï¼Œé¦–å…ˆè·å–å½“å‰ Python è§£é‡Šå™¨çš„è·¯å¾„ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿åœ¨æ­£ç¡®çš„ç¯å¢ƒä¸­è¿è¡Œè„šæœ¬ã€‚æ¥ç€ï¼Œæ„å»ºä¸€ä¸ªå‘½ä»¤å­—ç¬¦ä¸²ï¼Œè¯¥å‘½ä»¤ä½¿ç”¨ `streamlit` æ¨¡å—æ¥è¿è¡ŒæŒ‡å®šçš„è„šæœ¬ã€‚`streamlit` æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºæ•°æ®åº”ç”¨çš„åº“ï¼Œé€šå¸¸ç”¨äºå¿«é€Ÿåˆ›å»ºå’Œå…±äº«æœºå™¨å­¦ä¹ å’Œæ•°æ®ç§‘å­¦åº”ç”¨ã€‚

ç„¶åï¼Œä½¿ç”¨ `subprocess.run` æ–¹æ³•æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ã€‚è¿™ä¸ªæ–¹æ³•ä¼šåœ¨æ–°çš„å­è¿›ç¨‹ä¸­è¿è¡Œå‘½ä»¤ï¼Œå¹¶ç­‰å¾…å…¶å®Œæˆã€‚å¦‚æœå‘½ä»¤æ‰§è¡Œè¿”å›çš„çŠ¶æ€ç ä¸ä¸ºé›¶ï¼Œè¡¨ç¤ºè„šæœ¬è¿è¡Œè¿‡ç¨‹ä¸­å‡ºç°äº†é”™è¯¯ï¼Œç¨‹åºä¼šæ‰“å°å‡ºç›¸åº”çš„é”™è¯¯ä¿¡æ¯ã€‚

åœ¨æ–‡ä»¶çš„æœ€åéƒ¨åˆ†ï¼Œä½¿ç”¨ `if __name__ == "__main__":` è¯­å¥æ¥ç¡®ä¿åªæœ‰åœ¨ç›´æ¥è¿è¡Œè¯¥æ–‡ä»¶æ—¶æ‰ä¼šæ‰§è¡Œä¸‹é¢çš„ä»£ç ã€‚åœ¨è¿™é‡Œï¼ŒæŒ‡å®šäº†è¦è¿è¡Œçš„è„šæœ¬è·¯å¾„ä¸º `web.py`ï¼Œå¹¶è°ƒç”¨ `run_script` å‡½æ•°æ¥æ‰§è¡Œè¿™ä¸ªè„šæœ¬ã€‚

æ€»ä½“æ¥è¯´ï¼Œè¿™ä¸ªç¨‹åºçš„ç›®çš„æ˜¯æä¾›ä¸€ä¸ªç®€å•çš„æ¥å£ï¼Œé€šè¿‡å‘½ä»¤è¡Œè¿è¡Œä¸€ä¸ªåä¸º `web.py` çš„è„šæœ¬ï¼Œå¹¶ç¡®ä¿åœ¨å½“å‰ Python ç¯å¢ƒä¸­æ‰§è¡Œã€‚

#### 11.4 code\ultralytics\models\yolo\classify\predict.py

ä»¥ä¸‹æ˜¯ä»£ç ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
import cv2
import torch
from PIL import Image
from ultralytics.engine.predictor import BasePredictor
from ultralytics.engine.results import Results
from ultralytics.utils import ops

class ClassificationPredictor(BasePredictor):
    """
    ClassificationPredictorç±»ï¼Œç»§æ‰¿è‡ªBasePredictorç±»ï¼Œç”¨äºåŸºäºåˆ†ç±»æ¨¡å‹è¿›è¡Œé¢„æµ‹ã€‚
    """

    def __init__(self, cfg=DEFAULT_CFG, overrides=None, _callbacks=None):
        """åˆå§‹åŒ–ClassificationPredictorï¼Œå°†ä»»åŠ¡è®¾ç½®ä¸º'åˆ†ç±»'ã€‚"""
        super().__init__(cfg, overrides, _callbacks)  # è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°
        self.args.task = "classify"  # è®¾ç½®ä»»åŠ¡ç±»å‹ä¸ºåˆ†ç±»
        self._legacy_transform_name = "ultralytics.yolo.data.augment.ToTensor"  # æ—§ç‰ˆè½¬æ¢åç§°

    def preprocess(self, img):
        """å°†è¾“å…¥å›¾åƒè½¬æ¢ä¸ºæ¨¡å‹å…¼å®¹çš„æ•°æ®ç±»å‹ã€‚"""
        if not isinstance(img, torch.Tensor):  # å¦‚æœè¾“å…¥ä¸æ˜¯torchå¼ é‡
            is_legacy_transform = any(
                self._legacy_transform_name in str(transform) for transform in self.transforms.transforms
            )  # æ£€æŸ¥æ˜¯å¦ä½¿ç”¨æ—§ç‰ˆè½¬æ¢
            if is_legacy_transform:  # å¤„ç†æ—§ç‰ˆè½¬æ¢
                img = torch.stack([self.transforms(im) for im in img], dim=0)  # åº”ç”¨è½¬æ¢å¹¶å †å 
            else:
                img = torch.stack(
                    [self.transforms(Image.fromarray(cv2.cvtColor(im, cv2.COLOR_BGR2RGB))) for im in img], dim=0
                )  # è½¬æ¢ä¸ºRGBæ ¼å¼å¹¶åº”ç”¨è½¬æ¢
        img = (img if isinstance(img, torch.Tensor) else torch.from_numpy(img)).to(self.model.device)  # è½¬æ¢ä¸ºå¼ é‡å¹¶ç§»åŠ¨åˆ°æ¨¡å‹è®¾å¤‡
        return img.half() if self.model.fp16 else img.float()  # å°†uint8è½¬æ¢ä¸ºfp16æˆ–fp32

    def postprocess(self, preds, img, orig_imgs):
        """å¯¹é¢„æµ‹ç»“æœè¿›è¡Œåå¤„ç†ï¼Œè¿”å›Resultså¯¹è±¡ã€‚"""
        if not isinstance(orig_imgs, list):  # å¦‚æœåŸå§‹å›¾åƒä¸æ˜¯åˆ—è¡¨
            orig_imgs = ops.convert_torch2numpy_batch(orig_imgs)  # è½¬æ¢ä¸ºnumpyæ•°ç»„

        results = []  # åˆå§‹åŒ–ç»“æœåˆ—è¡¨
        for i, pred in enumerate(preds):  # éå†æ¯ä¸ªé¢„æµ‹ç»“æœ
            orig_img = orig_imgs[i]  # è·å–åŸå§‹å›¾åƒ
            img_path = self.batch[0][i]  # è·å–å›¾åƒè·¯å¾„
            results.append(Results(orig_img, path=img_path, names=self.model.names, probs=pred))  # åˆ›å»ºResultså¯¹è±¡å¹¶æ·»åŠ åˆ°ç»“æœåˆ—è¡¨
        return results  # è¿”å›ç»“æœåˆ—è¡¨
```

### ä»£ç æ ¸å¿ƒéƒ¨åˆ†è¯´æ˜ï¼š
1. **å¯¼å…¥åº“**ï¼šå¯¼å…¥å¿…è¦çš„åº“ï¼ŒåŒ…æ‹¬OpenCVã€PyTorchã€PILä»¥åŠUltralyticsçš„ç›¸å…³æ¨¡å—ã€‚
2. **ClassificationPredictorç±»**ï¼šè¿™æ˜¯ä¸€ä¸ªç”¨äºåˆ†ç±»ä»»åŠ¡çš„é¢„æµ‹å™¨ç±»ï¼Œç»§æ‰¿è‡ª`BasePredictor`ã€‚
3. **åˆå§‹åŒ–æ–¹æ³•**ï¼šè®¾ç½®ä»»åŠ¡ç±»å‹ä¸ºåˆ†ç±»ï¼Œå¹¶å¤„ç†æ—§ç‰ˆè½¬æ¢åç§°ã€‚
4. **é¢„å¤„ç†æ–¹æ³•**ï¼šå°†è¾“å…¥å›¾åƒè½¬æ¢ä¸ºæ¨¡å‹å¯ä»¥æ¥å—çš„æ ¼å¼ï¼ŒåŒ…æ‹¬å¤„ç†ä¸åŒç±»å‹çš„è¾“å…¥ï¼ˆå¦‚å¼ é‡æˆ–numpyæ•°ç»„ï¼‰ï¼Œå¹¶å°†å…¶ç§»åŠ¨åˆ°é€‚å½“çš„è®¾å¤‡ä¸Šã€‚
5. **åå¤„ç†æ–¹æ³•**ï¼šå°†æ¨¡å‹çš„é¢„æµ‹ç»“æœè½¬æ¢ä¸º`Results`å¯¹è±¡ï¼Œä¾¿äºåç»­å¤„ç†å’Œå±•ç¤ºã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶æ˜¯Ultralytics YOLOï¼ˆYou Only Look Onceï¼‰æ¨¡å‹çš„ä¸€éƒ¨åˆ†ï¼Œä¸»è¦ç”¨äºå›¾åƒåˆ†ç±»çš„é¢„æµ‹ã€‚æ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€ä¸ªåä¸º`ClassificationPredictor`çš„ç±»ï¼Œå®ƒç»§æ‰¿è‡ª`BasePredictor`ç±»ï¼Œä¸“é—¨ç”¨äºåŸºäºåˆ†ç±»æ¨¡å‹è¿›è¡Œé¢„æµ‹ã€‚

åœ¨æ–‡ä»¶çš„å¼€å¤´ï¼Œå¯¼å…¥äº†ä¸€äº›å¿…è¦çš„åº“ï¼ŒåŒ…æ‹¬`cv2`ï¼ˆç”¨äºå›¾åƒå¤„ç†ï¼‰ã€`torch`ï¼ˆç”¨äºæ·±åº¦å­¦ä¹ ï¼‰å’Œ`PIL`ï¼ˆç”¨äºå›¾åƒæ“ä½œï¼‰ã€‚æ¥ç€ï¼Œå¯¼å…¥äº†Ultralyticsåº“ä¸­çš„ä¸€äº›æ¨¡å—å’Œç±»ï¼Œå¦‚`BasePredictor`ã€`Results`å’Œ`DEFAULT_CFG`ç­‰ã€‚

`ClassificationPredictor`ç±»çš„æ„é€ å‡½æ•°`__init__`åˆå§‹åŒ–äº†é¢„æµ‹å™¨ï¼Œå¹¶å°†ä»»åŠ¡ç±»å‹è®¾ç½®ä¸ºâ€œclassifyâ€ã€‚å®ƒè¿˜å®šä¹‰äº†ä¸€ä¸ªåä¸º`_legacy_transform_name`çš„å±æ€§ï¼Œç”¨äºå¤„ç†æ—§ç‰ˆçš„å›¾åƒè½¬æ¢ã€‚

ç±»ä¸­æœ‰ä¸¤ä¸ªä¸»è¦çš„æ–¹æ³•ï¼š`preprocess`å’Œ`postprocess`ã€‚`preprocess`æ–¹æ³•è´Ÿè´£å°†è¾“å…¥å›¾åƒè½¬æ¢ä¸ºæ¨¡å‹æ‰€éœ€çš„æ•°æ®ç±»å‹ã€‚å¦‚æœè¾“å…¥çš„å›¾åƒä¸æ˜¯`torch.Tensor`ç±»å‹ï¼Œæ–¹æ³•ä¼šæ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†æ—§ç‰ˆçš„è½¬æ¢ï¼Œå¹¶æ ¹æ®æƒ…å†µè¿›è¡Œå¤„ç†ã€‚æœ€ç»ˆï¼Œå›¾åƒä¼šè¢«è½¬æ¢ä¸ºé€‚åˆæ¨¡å‹çš„æ ¼å¼ï¼Œå¹¶ç§»åŠ¨åˆ°æ¨¡å‹æ‰€åœ¨çš„è®¾å¤‡ä¸Šï¼ˆå¦‚GPUï¼‰ã€‚å¦‚æœæ¨¡å‹ä½¿ç”¨çš„æ˜¯åŠç²¾åº¦æµ®ç‚¹æ•°ï¼ˆfp16ï¼‰ï¼Œåˆ™ä¼šå°†å›¾åƒè½¬æ¢ä¸ºfp16æ ¼å¼ã€‚

`postprocess`æ–¹æ³•ç”¨äºå¯¹æ¨¡å‹çš„é¢„æµ‹ç»“æœè¿›è¡Œåå¤„ç†ï¼Œè¿”å›`Results`å¯¹è±¡ã€‚å®ƒé¦–å…ˆæ£€æŸ¥è¾“å…¥çš„åŸå§‹å›¾åƒæ˜¯å¦ä¸ºåˆ—è¡¨ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™å°†å…¶è½¬æ¢ä¸ºNumPyæ•°ç»„ã€‚ç„¶åï¼Œæ–¹æ³•éå†æ¯ä¸ªé¢„æµ‹ç»“æœï¼Œå¹¶å°†å…¶ä¸åŸå§‹å›¾åƒå’Œå›¾åƒè·¯å¾„å…³è”ï¼Œæœ€ç»ˆå°†æ‰€æœ‰ç»“æœå­˜å‚¨åœ¨ä¸€ä¸ªåˆ—è¡¨ä¸­å¹¶è¿”å›ã€‚

æ•´ä¸ªç±»çš„è®¾è®¡ä½¿å¾—ç”¨æˆ·å¯ä»¥æ–¹ä¾¿åœ°ä½¿ç”¨YOLOæ¨¡å‹è¿›è¡Œå›¾åƒåˆ†ç±»ï¼Œå¹¶èƒ½å¤Ÿå¤„ç†ä¸åŒæ ¼å¼çš„è¾“å…¥å›¾åƒï¼Œè¿”å›æ¸…æ™°çš„é¢„æµ‹ç»“æœã€‚é€šè¿‡ç¤ºä¾‹ä»£ç ï¼Œç”¨æˆ·å¯ä»¥çœ‹åˆ°å¦‚ä½•å®ä¾‹åŒ–`ClassificationPredictor`å¹¶è°ƒç”¨å…¶`predict_cli`æ–¹æ³•è¿›è¡Œé¢„æµ‹ã€‚

#### 11.5 70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\models\fastsam\val.py

ä»¥ä¸‹æ˜¯ä»£ç ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
# å¯¼å…¥å¿…è¦çš„æ¨¡å—
from ultralytics.models.yolo.segment import SegmentationValidator
from ultralytics.utils.metrics import SegmentMetrics

class FastSAMValidator(SegmentationValidator):
    """
    è‡ªå®šä¹‰éªŒè¯ç±»ï¼Œç”¨äºåœ¨Ultralytics YOLOæ¡†æ¶ä¸­è¿›è¡Œå¿«é€ŸSAMï¼ˆSegment Anything Modelï¼‰åˆ†å‰²éªŒè¯ã€‚

    è¯¥ç±»æ‰©å±•äº†SegmentationValidatorç±»ï¼Œä¸“é—¨å®šåˆ¶äº†å¿«é€ŸSAMçš„éªŒè¯è¿‡ç¨‹ã€‚å°†ä»»åŠ¡è®¾ç½®ä¸º'åˆ†å‰²'ï¼Œ
    å¹¶ä½¿ç”¨SegmentMetricsè¿›è¡Œè¯„ä¼°ã€‚æ­¤å¤–ï¼Œç¦ç”¨äº†ç»˜å›¾åŠŸèƒ½ï¼Œä»¥é¿å…åœ¨éªŒè¯è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ã€‚
    """

    def __init__(self, dataloader=None, save_dir=None, pbar=None, args=None, _callbacks=None):
        """
        åˆå§‹åŒ–FastSAMValidatorç±»ï¼Œå°†ä»»åŠ¡è®¾ç½®ä¸º'åˆ†å‰²'ï¼Œå¹¶å°†åº¦é‡æ ‡å‡†è®¾ç½®ä¸ºSegmentMetricsã€‚

        å‚æ•°ï¼š
            dataloader (torch.utils.data.DataLoader): ç”¨äºéªŒè¯çš„æ•°æ®åŠ è½½å™¨ã€‚
            save_dir (Path, optional): ä¿å­˜ç»“æœçš„ç›®å½•ã€‚
            pbar (tqdm.tqdm): ç”¨äºæ˜¾ç¤ºè¿›åº¦çš„è¿›åº¦æ¡ã€‚
            args (SimpleNamespace): éªŒè¯å™¨çš„é…ç½®ã€‚
            _callbacks (dict): å­˜å‚¨å„ç§å›è°ƒå‡½æ•°çš„å­—å…¸ã€‚

        æ³¨æ„ï¼š
            åœ¨æ­¤ç±»ä¸­ç¦ç”¨äº†ConfusionMatrixå’Œå…¶ä»–ç›¸å…³åº¦é‡çš„ç»˜å›¾ï¼Œä»¥é¿å…é”™è¯¯ã€‚
        """
        # è°ƒç”¨çˆ¶ç±»çš„åˆå§‹åŒ–æ–¹æ³•
        super().__init__(dataloader, save_dir, pbar, args, _callbacks)
        
        # è®¾ç½®ä»»åŠ¡ç±»å‹ä¸º'åˆ†å‰²'
        self.args.task = 'segment'
        
        # ç¦ç”¨ç»˜å›¾åŠŸèƒ½ï¼Œä»¥é¿å…åœ¨éªŒè¯è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯
        self.args.plots = False
        
        # åˆå§‹åŒ–åº¦é‡æ ‡å‡†ä¸ºSegmentMetricsï¼ŒæŒ‡å®šä¿å­˜ç»“æœçš„ç›®å½•
        self.metrics = SegmentMetrics(save_dir=self.save_dir, on_plot=self.on_plot)
```

### ä»£ç è¯´æ˜ï¼š
1. **å¯¼å…¥æ¨¡å—**ï¼šå¼•å…¥äº†`SegmentationValidator`å’Œ`SegmentMetrics`ï¼Œè¿™ä¸¤ä¸ªæ¨¡å—æ˜¯è¿›è¡Œåˆ†å‰²éªŒè¯å’Œè®¡ç®—åˆ†å‰²æŒ‡æ ‡çš„åŸºç¡€ã€‚
  
2. **FastSAMValidatorç±»**ï¼šè¯¥ç±»ç»§æ‰¿è‡ª`SegmentationValidator`ï¼Œä¸“é—¨ç”¨äºå¿«é€ŸSAMçš„åˆ†å‰²éªŒè¯ã€‚å®ƒé‡å†™äº†åˆå§‹åŒ–æ–¹æ³•ï¼Œä»¥ä¾¿è®¾ç½®ç‰¹å®šçš„ä»»åŠ¡å’Œåº¦é‡æ ‡å‡†ã€‚

3. **åˆå§‹åŒ–æ–¹æ³•**ï¼š
   - æ¥æ”¶å¤šä¸ªå‚æ•°ï¼ŒåŒ…æ‹¬æ•°æ®åŠ è½½å™¨ã€ä¿å­˜ç›®å½•ã€è¿›åº¦æ¡ã€é…ç½®å‚æ•°å’Œå›è°ƒå‡½æ•°ã€‚
   - è°ƒç”¨çˆ¶ç±»çš„åˆå§‹åŒ–æ–¹æ³•ä»¥ç¡®ä¿åŸºç±»çš„åŠŸèƒ½è¢«æ­£ç¡®è®¾ç½®ã€‚
   - å°†ä»»åŠ¡ç±»å‹è®¾ç½®ä¸º'åˆ†å‰²'ï¼Œä»¥ä¾¿äºåç»­çš„éªŒè¯è¿‡ç¨‹ã€‚
   - ç¦ç”¨ç»˜å›¾åŠŸèƒ½ï¼Œä»¥é¿å…åœ¨éªŒè¯è¿‡ç¨‹ä¸­å‡ºç°ä¸ç»˜å›¾ç›¸å…³çš„é”™è¯¯ã€‚
   - åˆå§‹åŒ–åˆ†å‰²åº¦é‡æ ‡å‡†ï¼ŒæŒ‡å®šç»“æœä¿å­˜çš„ç›®å½•ï¼Œä»¥ä¾¿åœ¨éªŒè¯åèƒ½å¤Ÿè®°å½•å’Œåˆ†æç»“æœã€‚

è¯¥ç¨‹åºæ–‡ä»¶å®šä¹‰äº†ä¸€ä¸ªåä¸º `FastSAMValidator` çš„ç±»ï¼Œç»§æ‰¿è‡ª `SegmentationValidator`ï¼Œç”¨äºåœ¨ Ultralytics YOLO æ¡†æ¶ä¸­è¿›è¡Œå¿«é€Ÿ SAMï¼ˆSegment Anything Modelï¼‰åˆ†å‰²çš„è‡ªå®šä¹‰éªŒè¯ã€‚è¿™ä¸ªç±»ä¸»è¦ç”¨äºè®¾ç½®åˆ†å‰²ä»»åŠ¡ï¼Œå¹¶ä½¿ç”¨ `SegmentMetrics` è¿›è¡Œè¯„ä¼°ï¼ŒåŒæ—¶ä¸ºäº†é¿å…åœ¨éªŒè¯è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œç¦ç”¨äº†ç»˜å›¾åŠŸèƒ½ã€‚

åœ¨ç±»çš„æ„é€ å‡½æ•° `__init__` ä¸­ï¼Œåˆå§‹åŒ–äº†å¤šä¸ªå‚æ•°ï¼ŒåŒ…æ‹¬æ•°æ®åŠ è½½å™¨ `dataloader`ã€ç»“æœä¿å­˜ç›®å½• `save_dir`ã€è¿›åº¦æ¡ `pbar`ã€å…¶ä»–é…ç½®å‚æ•° `args` ä»¥åŠå›è°ƒå‡½æ•° `_callbacks`ã€‚æ„é€ å‡½æ•°é¦–å…ˆè°ƒç”¨äº†çˆ¶ç±»çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œç„¶åå°†ä»»åŠ¡ç±»å‹è®¾ç½®ä¸º 'segment'ï¼Œå¹¶ç¦ç”¨äº†ç»˜å›¾åŠŸèƒ½ï¼Œä»¥é¿å…åœ¨éªŒè¯è¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°çš„é”™è¯¯ã€‚

æ­¤å¤–ï¼Œ`metrics` å±æ€§è¢«è®¾ç½®ä¸º `SegmentMetrics` çš„å®ä¾‹ï¼Œç”¨äºè¯„ä¼°åˆ†å‰²ç»“æœå¹¶ä¿å­˜åˆ°æŒ‡å®šçš„ç›®å½•ä¸­ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œ`FastSAMValidator` ç±»èƒ½å¤Ÿä¸“æ³¨äºå¿«é€Ÿ SAM çš„éªŒè¯è¿‡ç¨‹ï¼Œç¡®ä¿åœ¨åˆ†å‰²ä»»åŠ¡ä¸­èƒ½å¤Ÿæœ‰æ•ˆåœ°è¿›è¡Œæ€§èƒ½è¯„ä¼°ã€‚

#### 11.6 train.py

ä»¥ä¸‹æ˜¯ç»è¿‡ç®€åŒ–å’Œæ³¨é‡Šçš„æ ¸å¿ƒä»£ç éƒ¨åˆ†ï¼š

```python
import random
import numpy as np
import torch.nn as nn
from ultralytics.data import build_dataloader, build_yolo_dataset
from ultralytics.engine.trainer import BaseTrainer
from ultralytics.models import yolo
from ultralytics.nn.tasks import DetectionModel
from ultralytics.utils import LOGGER, RANK
from ultralytics.utils.torch_utils import de_parallel, torch_distributed_zero_first

class DetectionTrainer(BaseTrainer):
    """
    æ‰©å±•è‡ª BaseTrainer ç±»ï¼Œç”¨äºåŸºäºæ£€æµ‹æ¨¡å‹çš„è®­ç»ƒã€‚
    """

    def build_dataset(self, img_path, mode="train", batch=None):
        """
        æ„å»º YOLO æ•°æ®é›†ã€‚

        å‚æ•°:
            img_path (str): åŒ…å«å›¾åƒçš„æ–‡ä»¶å¤¹è·¯å¾„ã€‚
            mode (str): æ¨¡å¼ä¸º `train` æˆ– `val`ï¼Œç”¨æˆ·å¯ä»¥ä¸ºæ¯ç§æ¨¡å¼è‡ªå®šä¹‰ä¸åŒçš„å¢å¼ºã€‚
            batch (int, optional): æ‰¹æ¬¡å¤§å°ï¼Œä»…ç”¨äº `rect` æ¨¡å¼ã€‚é»˜è®¤ä¸º Noneã€‚
        """
        gs = max(int(de_parallel(self.model).stride.max() if self.model else 0), 32)  # è·å–æ¨¡å‹çš„æœ€å¤§æ­¥å¹…
        return build_yolo_dataset(self.args, img_path, batch, self.data, mode=mode, rect=mode == "val", stride=gs)

    def get_dataloader(self, dataset_path, batch_size=16, rank=0, mode="train"):
        """æ„é€ å¹¶è¿”å›æ•°æ®åŠ è½½å™¨ã€‚"""
        assert mode in ["train", "val"]  # ç¡®ä¿æ¨¡å¼æœ‰æ•ˆ
        with torch_distributed_zero_first(rank):  # åœ¨åˆ†å¸ƒå¼è®­ç»ƒä¸­ï¼Œä»…åˆå§‹åŒ–ä¸€æ¬¡æ•°æ®é›†
            dataset = self.build_dataset(dataset_path, mode, batch_size)
        shuffle = mode == "train"  # è®­ç»ƒæ¨¡å¼ä¸‹æ‰“ä¹±æ•°æ®
        workers = self.args.workers if mode == "train" else self.args.workers * 2  # è®¾ç½®å·¥ä½œçº¿ç¨‹æ•°
        return build_dataloader(dataset, batch_size, workers, shuffle, rank)  # è¿”å›æ•°æ®åŠ è½½å™¨

    def preprocess_batch(self, batch):
        """å¯¹å›¾åƒæ‰¹æ¬¡è¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬ç¼©æ”¾å’Œè½¬æ¢ä¸ºæµ®ç‚¹æ•°ã€‚"""
        batch["img"] = batch["img"].to(self.device, non_blocking=True).float() / 255  # è½¬æ¢ä¸ºæµ®ç‚¹æ•°å¹¶å½’ä¸€åŒ–
        if self.args.multi_scale:  # å¦‚æœå¯ç”¨å¤šå°ºåº¦
            imgs = batch["img"]
            sz = (
                random.randrange(self.args.imgsz * 0.5, self.args.imgsz * 1.5 + self.stride)
                // self.stride
                * self.stride
            )  # éšæœºé€‰æ‹©å›¾åƒå¤§å°
            sf = sz / max(imgs.shape[2:])  # è®¡ç®—ç¼©æ”¾å› å­
            if sf != 1:
                ns = [
                    math.ceil(x * sf / self.stride) * self.stride for x in imgs.shape[2:]
                ]  # è®¡ç®—æ–°çš„å½¢çŠ¶
                imgs = nn.functional.interpolate(imgs, size=ns, mode="bilinear", align_corners=False)  # è¿›è¡Œæ’å€¼ç¼©æ”¾
            batch["img"] = imgs
        return batch

    def set_model_attributes(self):
        """è®¾ç½®æ¨¡å‹çš„å±æ€§ï¼ŒåŒ…æ‹¬ç±»åˆ«æ•°é‡å’Œåç§°ã€‚"""
        self.model.nc = self.data["nc"]  # å°†ç±»åˆ«æ•°é‡é™„åŠ åˆ°æ¨¡å‹
        self.model.names = self.data["names"]  # å°†ç±»åˆ«åç§°é™„åŠ åˆ°æ¨¡å‹
        self.model.args = self.args  # å°†è¶…å‚æ•°é™„åŠ åˆ°æ¨¡å‹

    def get_model(self, cfg=None, weights=None, verbose=True):
        """è¿”å› YOLO æ£€æµ‹æ¨¡å‹ã€‚"""
        model = DetectionModel(cfg, nc=self.data["nc"], verbose=verbose and RANK == -1)  # åˆ›å»ºæ£€æµ‹æ¨¡å‹
        if weights:
            model.load(weights)  # åŠ è½½æƒé‡
        return model

    def plot_training_samples(self, batch, ni):
        """ç»˜åˆ¶å¸¦æœ‰æ³¨é‡Šçš„è®­ç»ƒæ ·æœ¬ã€‚"""
        plot_images(
            images=batch["img"],
            batch_idx=batch["batch_idx"],
            cls=batch["cls"].squeeze(-1),
            bboxes=batch["bboxes"],
            paths=batch["im_file"],
            fname=self.save_dir / f"train_batch{ni}.jpg",
            on_plot=self.on_plot,
        )
```

### ä»£ç è¯´æ˜ï¼š
1. **DetectionTrainer ç±»**ï¼šç»§æ‰¿è‡ª `BaseTrainer`ï¼Œç”¨äºè®­ç»ƒ YOLO æ£€æµ‹æ¨¡å‹ã€‚
2. **build_dataset æ–¹æ³•**ï¼šæ„å»ºæ•°æ®é›†ï¼Œæ¥æ”¶å›¾åƒè·¯å¾„ã€æ¨¡å¼å’Œæ‰¹æ¬¡å¤§å°ï¼Œè¿”å› YOLO æ•°æ®é›†ã€‚
3. **get_dataloader æ–¹æ³•**ï¼šæ„é€ æ•°æ®åŠ è½½å™¨ï¼Œç¡®ä¿åœ¨åˆ†å¸ƒå¼è®­ç»ƒä¸­åªåˆå§‹åŒ–ä¸€æ¬¡æ•°æ®é›†ã€‚
4. **preprocess_batch æ–¹æ³•**ï¼šå¯¹è¾“å…¥çš„å›¾åƒæ‰¹æ¬¡è¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬å½’ä¸€åŒ–å’Œç¼©æ”¾ã€‚
5. **set_model_attributes æ–¹æ³•**ï¼šè®¾ç½®æ¨¡å‹çš„ç±»åˆ«æ•°é‡å’Œåç§°ã€‚
6. **get_model æ–¹æ³•**ï¼šè¿”å›ä¸€ä¸ª YOLO æ£€æµ‹æ¨¡å‹ï¼Œå¯ä»¥é€‰æ‹©åŠ è½½é¢„è®­ç»ƒæƒé‡ã€‚
7. **plot_training_samples æ–¹æ³•**ï¼šç»˜åˆ¶è®­ç»ƒæ ·æœ¬åŠå…¶æ³¨é‡Šï¼Œç”¨äºå¯è§†åŒ–è®­ç»ƒè¿‡ç¨‹ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶ `train.py` æ˜¯ä¸€ä¸ªç”¨äºè®­ç»ƒ YOLOï¼ˆYou Only Look Onceï¼‰ç›®æ ‡æ£€æµ‹æ¨¡å‹çš„è„šæœ¬ï¼Œç»§æ‰¿è‡ª `BaseTrainer` ç±»ã€‚å®ƒä¸»è¦åŒ…å«äº†æ•°æ®é›†æ„å»ºã€æ•°æ®åŠ è½½ã€æ¨¡å‹è®¾ç½®ã€è®­ç»ƒè¿‡ç¨‹ä¸­çš„æŸå¤±è®¡ç®—ã€è¿›åº¦æ˜¾ç¤ºä»¥åŠç»“æœå¯è§†åŒ–ç­‰åŠŸèƒ½ã€‚

åœ¨ç¨‹åºçš„å¼€å¤´ï¼Œå¯¼å…¥äº†ä¸€äº›å¿…è¦çš„åº“å’Œæ¨¡å—ï¼ŒåŒ…æ‹¬æ•°å­¦è¿ç®—ã€éšæœºæ•°ç”Ÿæˆã€æ·±åº¦å­¦ä¹ æ¡†æ¶ PyTorch ç›¸å…³çš„æ¨¡å—ï¼Œä»¥åŠ Ultralytics æä¾›çš„ YOLO ç›¸å…³çš„å·¥å…·å’Œå‡½æ•°ã€‚

`DetectionTrainer` ç±»æ˜¯è¯¥æ–‡ä»¶çš„æ ¸å¿ƒï¼Œè´Ÿè´£å¤„ç†ç›®æ ‡æ£€æµ‹æ¨¡å‹çš„è®­ç»ƒã€‚é¦–å…ˆï¼Œå®ƒå®šä¹‰äº† `build_dataset` æ–¹æ³•ï¼Œç”¨äºæ„å»º YOLO æ•°æ®é›†ã€‚è¯¥æ–¹æ³•æ¥å—å›¾åƒè·¯å¾„ã€æ¨¡å¼ï¼ˆè®­ç»ƒæˆ–éªŒè¯ï¼‰å’Œæ‰¹é‡å¤§å°ä½œä¸ºå‚æ•°ï¼Œåˆ©ç”¨ `build_yolo_dataset` å‡½æ•°ç”Ÿæˆæ•°æ®é›†ã€‚

æ¥ä¸‹æ¥ï¼Œ`get_dataloader` æ–¹æ³•ç”¨äºæ„å»ºæ•°æ®åŠ è½½å™¨ã€‚å®ƒæ ¹æ®æ¨¡å¼é€‰æ‹©æ˜¯å¦æ‰“ä¹±æ•°æ®ï¼Œå¹¶è®¾ç½®å·¥ä½œçº¿ç¨‹çš„æ•°é‡ã€‚é€šè¿‡è°ƒç”¨ `build_dataloader` å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªå¯ä»¥åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è¿­ä»£çš„æ•°æ®åŠ è½½å™¨ã€‚

`preprocess_batch` æ–¹æ³•è´Ÿè´£å¯¹è¾“å…¥çš„å›¾åƒæ‰¹æ¬¡è¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬å°†å›¾åƒç¼©æ”¾åˆ°åˆé€‚çš„å¤§å°å¹¶è½¬æ¢ä¸ºæµ®ç‚¹æ•°æ ¼å¼ã€‚è¯¥æ–¹æ³•è¿˜æ”¯æŒå¤šå°ºåº¦è®­ç»ƒï¼Œé€šè¿‡éšæœºé€‰æ‹©å›¾åƒå¤§å°æ¥å¢å¼ºæ¨¡å‹çš„é²æ£’æ€§ã€‚

`set_model_attributes` æ–¹æ³•ç”¨äºè®¾ç½®æ¨¡å‹çš„å±æ€§ï¼ŒåŒ…æ‹¬ç±»åˆ«æ•°é‡å’Œç±»åˆ«åç§°ç­‰ï¼Œä»¥ç¡®ä¿æ¨¡å‹ä¸æ•°æ®é›†çš„ä¸€è‡´æ€§ã€‚

`get_model` æ–¹æ³•è¿”å›ä¸€ä¸ª YOLO æ£€æµ‹æ¨¡å‹å®ä¾‹ï¼Œå¹¶å¯é€‰æ‹©åŠ è½½é¢„è®­ç»ƒæƒé‡ã€‚`get_validator` æ–¹æ³•åˆ™è¿”å›ä¸€ä¸ªç”¨äºæ¨¡å‹éªŒè¯çš„ `DetectionValidator` å®ä¾‹ï¼Œå¸®åŠ©è¯„ä¼°æ¨¡å‹åœ¨éªŒè¯é›†ä¸Šçš„è¡¨ç°ã€‚

`label_loss_items` æ–¹æ³•ç”¨äºç”Ÿæˆä¸€ä¸ªåŒ…å«è®­ç»ƒæŸå¤±é¡¹çš„å­—å…¸ï¼Œæ–¹ä¾¿åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è®°å½•å’Œåˆ†ææŸå¤±æƒ…å†µã€‚`progress_string` æ–¹æ³•è¿”å›ä¸€ä¸ªæ ¼å¼åŒ–çš„å­—ç¬¦ä¸²ï¼Œæ˜¾ç¤ºè®­ç»ƒè¿›åº¦ï¼ŒåŒ…æ‹¬å½“å‰çš„ epochã€GPU å†…å­˜ä½¿ç”¨æƒ…å†µã€æŸå¤±å€¼ã€å®ä¾‹æ•°é‡å’Œå›¾åƒå¤§å°ç­‰ä¿¡æ¯ã€‚

`plot_training_samples` æ–¹æ³•ç”¨äºå¯è§†åŒ–è®­ç»ƒæ ·æœ¬åŠå…¶æ ‡æ³¨ï¼Œé€šè¿‡è°ƒç”¨ `plot_images` å‡½æ•°å°†å›¾åƒå’Œæ ‡æ³¨ä¿¡æ¯ç»˜åˆ¶åˆ°æ–‡ä»¶ä¸­ã€‚`plot_metrics` å’Œ `plot_training_labels` æ–¹æ³•åˆ™åˆ†åˆ«ç”¨äºç»˜åˆ¶è®­ç»ƒè¿‡ç¨‹ä¸­çš„æŒ‡æ ‡å’Œæ ‡æ³¨ä¿¡æ¯ï¼Œå¸®åŠ©ç”¨æˆ·ç›´è§‚åœ°äº†è§£æ¨¡å‹çš„è®­ç»ƒæ•ˆæœã€‚

æ€»çš„æ¥è¯´ï¼Œè¿™ä¸ªæ–‡ä»¶å®ç°äº† YOLO æ¨¡å‹è®­ç»ƒçš„å„ä¸ªæ–¹é¢ï¼Œä»æ•°æ®å¤„ç†åˆ°æ¨¡å‹è®­ç»ƒï¼Œå†åˆ°ç»“æœå¯è§†åŒ–ï¼Œæä¾›äº†ä¸€ä¸ªå®Œæ•´çš„è®­ç»ƒæ¡†æ¶ã€‚

### 12.ç³»ç»Ÿæ•´ä½“ç»“æ„ï¼ˆèŠ‚é€‰ï¼‰

### æ•´ä½“åŠŸèƒ½å’Œæ„æ¶æ¦‚æ‹¬

è¯¥é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäºYOLOï¼ˆYou Only Look Onceï¼‰æ¡†æ¶çš„è®¡ç®—æœºè§†è§‰å·¥å…·é›†ï¼Œä¸»è¦ç”¨äºç›®æ ‡æ£€æµ‹ã€å›¾åƒåˆ†ç±»å’Œåˆ†å‰²ç­‰ä»»åŠ¡ã€‚é¡¹ç›®åŒ…å«å¤šä¸ªæ¨¡å—å’Œæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶è´Ÿè´£ç‰¹å®šçš„åŠŸèƒ½ï¼Œå¦‚æ¨¡å‹å®šä¹‰ã€è®­ç»ƒã€éªŒè¯ã€é¢„æµ‹å’Œå·¥å…·å‡½æ•°ç­‰ã€‚æ•´ä½“æ¶æ„æ—¨åœ¨æä¾›ä¸€ä¸ªçµæ´»ä¸”é«˜æ•ˆçš„ç¯å¢ƒï¼Œä»¥ä¾¿äºç”¨æˆ·è¿›è¡Œæ¨¡å‹è®­ç»ƒã€è¯„ä¼°å’Œåº”ç”¨ã€‚

ä»¥ä¸‹æ˜¯é¡¹ç›®ä¸­å„ä¸ªæ–‡ä»¶çš„åŠŸèƒ½æ•´ç†è¡¨ï¼š

| æ–‡ä»¶è·¯å¾„                                                                 | åŠŸèƒ½æè¿°                                                                                     |
|--------------------------------------------------------------------------|----------------------------------------------------------------------------------------------|
| `code\ultralytics\nn\modules\utils.py`                                   | å®šä¹‰æ·±åº¦å­¦ä¹ æ¨¡å‹ä¸­å¸¸ç”¨çš„å·¥å…·å‡½æ•°ï¼Œå¦‚æƒé‡åˆå§‹åŒ–ã€åç½®è®¡ç®—ã€åsigmoidç­‰ã€‚                          |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\nn\backbone\SwinTransformer.py` | å®ç°Swin Transformeræ¨¡å‹çš„å„ä¸ªç»„ä»¶ï¼ŒåŒ…æ‹¬å¤šå¤´è‡ªæ³¨æ„åŠ›æœºåˆ¶ã€ç‰¹å¾æå–å’Œæ¨¡å‹ç»“æ„å®šä¹‰ã€‚               |
| `ui.py`                                                                  | æä¾›ä¸€ä¸ªæ¥å£ï¼Œé€šè¿‡å‘½ä»¤è¡Œè¿è¡ŒæŒ‡å®šçš„è„šæœ¬ï¼ˆå¦‚`web.py`ï¼‰ï¼Œç”¨äºå¿«é€Ÿå¯åŠ¨åº”ç”¨ç¨‹åºã€‚                     |
| `code\ultralytics\models\yolo\classify\predict.py`                     | å®ç°å›¾åƒåˆ†ç±»çš„é¢„æµ‹åŠŸèƒ½ï¼Œå¤„ç†è¾“å…¥å›¾åƒå¹¶è¿”å›åˆ†ç±»ç»“æœã€‚                                          |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\models\fastsam\val.py` | å®šä¹‰FastSAMéªŒè¯å™¨ç±»ï¼Œç”¨äºå¿«é€ŸSAMåˆ†å‰²ä»»åŠ¡çš„éªŒè¯å’Œè¯„ä¼°ã€‚                                         |
| `train.py`                                                              | è´Ÿè´£YOLOæ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹ï¼ŒåŒ…æ‹¬æ•°æ®åŠ è½½ã€æ¨¡å‹è®¾ç½®ã€æŸå¤±è®¡ç®—å’Œç»“æœå¯è§†åŒ–ç­‰åŠŸèƒ½ã€‚                    |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\models\fastsam\predict.py` | å®ç°FastSAMæ¨¡å‹çš„é¢„æµ‹åŠŸèƒ½ï¼Œå¤„ç†è¾“å…¥å¹¶è¿”å›åˆ†å‰²ç»“æœã€‚                                            |
| `code\ultralytics\trackers\__init__.py`                                 | åˆå§‹åŒ–è·Ÿè¸ªå™¨æ¨¡å—ï¼Œå¯èƒ½åŒ…å«è·Ÿè¸ªç›¸å…³çš„ç±»å’Œå‡½æ•°ã€‚                                                 |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\trackers\bot_sort.py` | å®ç°Bot Sortè·Ÿè¸ªç®—æ³•ï¼Œç”¨äºç›®æ ‡è·Ÿè¸ªä»»åŠ¡ã€‚                                                      |
| `code\ultralytics\models\rtdetr\model.py`                               | å®šä¹‰RT-DETRï¼ˆReal-Time DEtection TRansformerï¼‰æ¨¡å‹çš„ç»“æ„å’ŒåŠŸèƒ½ï¼Œç”¨äºç›®æ ‡æ£€æµ‹ã€‚                   |
| `code\ultralytics\cfg\__init__.py`                                      | åˆå§‹åŒ–é…ç½®æ¨¡å—ï¼Œå¯èƒ½åŒ…å«é¡¹ç›®çš„é…ç½®å‚æ•°å’Œè®¾ç½®ã€‚                                                |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\models\utils\loss.py` | å®šä¹‰æŸå¤±å‡½æ•°å’Œè®¡ç®—æ–¹æ³•ï¼Œç”¨äºè®­ç»ƒè¿‡ç¨‹ä¸­è¯„ä¼°æ¨¡å‹æ€§èƒ½ã€‚                                           |
| `code\ultralytics\models\yolo\detect\train.py`                         | å®ç°YOLOæ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹ï¼Œå¤„ç†æ•°æ®é›†ã€æ¨¡å‹æ„å»ºå’Œè®­ç»ƒé€»è¾‘ã€‚                                       |

è¿™ä¸ªè¡¨æ ¼æ€»ç»“äº†é¡¹ç›®ä¸­å„ä¸ªæ–‡ä»¶çš„ä¸»è¦åŠŸèƒ½ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿäº†è§£é¡¹ç›®çš„ç»“æ„å’Œå„ä¸ªæ¨¡å—çš„ä½œç”¨ã€‚

æ³¨æ„ï¼šç”±äºæ­¤åšå®¢ç¼–è¾‘è¾ƒæ—©ï¼Œä¸Šé¢â€œ11.é¡¹ç›®æ ¸å¿ƒæºç è®²è§£ï¼ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒçœ‹ä¸æ‡‚ä»£ç é€»è¾‘ï¼‰â€ä¸­éƒ¨åˆ†ä»£ç å¯èƒ½ä¼šä¼˜åŒ–å‡çº§ï¼Œä»…ä¾›å‚è€ƒå­¦ä¹ ï¼Œå®Œæ•´â€œè®­ç»ƒæºç â€ã€â€œWebå‰ç«¯ç•Œé¢â€å’Œâ€œ70+ç§åˆ›æ–°ç‚¹æºç â€ä»¥â€œ13.å®Œæ•´è®­ç»ƒ+Webå‰ç«¯ç•Œé¢+70+ç§åˆ›æ–°ç‚¹æºç ã€æ•°æ®é›†è·å–â€çš„å†…å®¹ä¸ºå‡†ã€‚

### 13.å®Œæ•´è®­ç»ƒ+Webå‰ç«¯ç•Œé¢+70+ç§åˆ›æ–°ç‚¹æºç ã€æ•°æ®é›†è·å–

![19.png](19.png)


# [ä¸‹è½½é“¾æ¥ï¼šhttps://mbd.pub/o/bread/ZpuWkpZy](https://mbd.pub/o/bread/ZpuWkpZy)